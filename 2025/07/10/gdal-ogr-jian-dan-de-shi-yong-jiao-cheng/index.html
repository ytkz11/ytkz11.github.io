<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>GDAL_OGR简单的使用教程 | Find everything you need</title><meta name="keywords" content="遥感"><meta name="author" content="ytkz"><meta name="copyright" content="ytkz"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="GDAL_OGR简单的使用教程"><meta name="application-name" content="GDAL_OGR简单的使用教程"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="GDAL_OGR简单的使用教程"><meta property="og:url" content="http://ytkz11@.github.io/2025/07/10/gdal-ogr-jian-dan-de-shi-yong-jiao-cheng/index.html"><meta property="og:site_name" content="Find everything you need"><meta property="og:description" content="GDAL_OGR简单的使用教程检测安装from osgeo import gdal 查看版本gdal.VersionInfo(&amp;#39;VERSION_NUM&amp;#39;)  # &amp;#39;2040100&amp;#39; 开启python异常默认情况下，发生错误时，GDAL&amp;#x2F;OGR Python绑定不会引发异常。相反，它们返回错误值（例如"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/ytkz11/picture/imgs202507161641982.png"><meta property="article:author" content="ytkz"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/ytkz11/picture/imgs202507161641982.png"><meta name="description" content="GDAL_OGR简单的使用教程检测安装from osgeo import gdal 查看版本gdal.VersionInfo(&amp;#39;VERSION_NUM&amp;#39;)  # &amp;#39;2040100&amp;#39; 开启python异常默认情况下，发生错误时，GDAL&amp;#x2F;OGR Python绑定不会引发异常。相反，它们返回错误值（例如"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://ytkz11@.github.io/2025/07/10/gdal-ogr-jian-dan-de-shi-yong-jiao-cheng/"><link rel="preconnect" href="//cdn.cbd.int"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: {"enable":true,"img":"https://upload-bbs.miyoushe.com/upload/2023/09/03/125766904/ee23df8517f3c3e3efc4145658269c06_5714860933110284659.png"},
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎回来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: undefined,
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"prismjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: ytkz","link":"链接: ","source":"来源: Find everything you need","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Find everything you need',
  title: 'GDAL_OGR简单的使用教程',
  postAI: '',
  pageFillDescription: 'GDAL_OGR简单的使用教程, 检测安装, 查看版本, 开启python异常, 安装GDAL OGR错误处理, 栅格图层, 关闭栅格数据, 获取元数据, 波段融合, 获取波段, 遍历波段, 获取波段信息, 多边形化栅格波段, 栅格化矢量数据, 用shapefile裁剪栅格, 区域统计, 从数组创建栅格, 替换无效值, 投影, 创建投影, 重投影, 获取投影, 重投影图层, 输出投影, 创建ESRI投影文件, 创建质心, 矢量图层, 删除文件, 获取OGR驱动列表, 驱动是否可用, 获取shapefile要素个数, 获取PostGIS图层, 获取PostGIS图层的要素, 获取ESRI GDB图层, 加载数据到内存, 遍历要素, 遍历要素几何, 过滤属性, 空间过滤, 获取要素字段, 获取PostGIS图层字段, 获取图层能力, WFS图层和遍历要素, 设置HTTP代理, 读取CSV经纬度作为OGRVRTLayer, 计算范围, 计算凸包, 计算质心, 创建新的shp数据并添加数据, 从WKT创建PostGIS表, 过滤和选择, 合并图层, 获取OSM街道名称, 创建鱼网, 面转线, 创建缓冲区, 栅格化矢量图层, 面转点简单的使用教程检测安装查看版本开启异常默认情况下发生错误时绑定不会引发异常相反它们返回错误值例如并将错误消息写入你可以通过调用函数来开启异常开启异常打开不存在的数据集开启异常前开启异常后你可以在运行的任何时候使用以下命令禁用异常安装错误处理安装错误处理程序功能以捕获错误类和消息仅适用于以上的版本错误处理方法安装错误处理抛出一个假的错误卸载错误处理栅格图层关闭栅格数据打开数据关闭数据非必须获取元数据波段融合打开数据获取波段创建数据设置坐标和投影写入数据获取波段允许异常试一下遍历波段波段个数获取波段获取波段信息多边形化栅格波段栅格化矢量数据定义像素大小和无效值打开数据并读取范围栅格化用裁剪栅格转换为数组数组转换为用地理仿射变换计算像素坐标读取数据到数组获取地理仿射变换获取矢量图层获取范围计算像素大小像素偏移创建新的仿射变换区域统计从数组创建栅格反转数组数组转栅格替换无效值栅格转数组获取无效值更新无效值数组转栅格投影创建投影重投影获取投影图层几何重投影图层输入空间参考输出空间参考创建坐标转换输入图层创建输出图层输出文件添加字段遍历要素获取几何重投影几何创建要素设置几何属性添加要素取消引用保存并关闭输出投影创建投影文件创建质心矢量图层删除文件获取驱动列表排序驱动是否可用是否可用驱动不可用驱动可用是否可用驱动不可用驱动可用是否可用驱动不可用驱动可用是否可用驱动不可用驱动可用获取要素个数只读读写检查数据源是否有效不能打开打开要素个数获取图层关闭连接获取图层的要素要素个数关闭连接获取图层获取图层加载数据到内存打开输入数据源创建内存输出数据源打开内存数据复制图层到内存新的图层可直接被访问或者遍历要素遍历要素几何获取质心过滤属性空间过滤获取要素字段获取图层字段获取图层能力图层能力图层和遍历要素获取驱动加快查询多图层服务设置分页的配置适用于服务以及和以及其他一些服务错误不能打开数据源遍历图层遍历要素获取指定图层错误不能找到图层设置代理设置代理没有用户名或密码的设置代理身份验证选项因此单点登录有效读取经纬度作为具有虚拟格式规范该规范允许你从诸如之类的平面表派生图层它的功能远不止于此因此请继续阅读在下面的示例中我们正在读取带有列和值的该文件由文件包装该文件将其描述为层以下是所有必要的部分和一个脚本该脚本读取文件并打印出点的几何形状文件文件计算范围创建多边形保存到新的文件如果存在先删除创建数据源添加字段创建要素保存并关闭计算凸包获得图层几何集合计算凸包保存如果存在先删除输出添加字段创建要素保存并关闭计算质心输入图层输出图层如果存在先删除添加字段获得要素定义添加要素输入要素输出要素设置字段值设置质心几何添加新要素保存并关闭创建新的数据并添加数据使用字典读取数据驱动创建数据源创建空间参考创建图层添加字段处理文本创建要素设置属性字段创建创建点设置几何添加要素删除引用保存关闭从创建表过滤和选择该命令读取并生成输出列输入图层创建输出图层存在先删除创建输出添加字段要素定义添加要素创建要素添加字段设置几何创建要素保存关闭合并图层获取街道名称测试创建鱼网面转线创建缓冲区栅格化矢量图层定义像素大小和无效值打开数据源读取数据范围创建目标数据源栅格化读取为数组面转点测试',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-07-17 10:16:07',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.2">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="Find everything you need" type="application/atom+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">Find everything you need</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/null"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/null"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/GDAL/" style="font-size: 1.05rem;">GDAL<sup>4</sup></a><a href="/tags/GEE/" style="font-size: 1.05rem;">GEE<sup>1</sup></a><a href="/tags/GIS/" style="font-size: 1.05rem;">GIS<sup>8</sup></a><a href="/tags/IDL/" style="font-size: 1.05rem;">IDL<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 1.05rem;">JavaScript<sup>1</sup></a><a href="/tags/Python/" style="font-size: 1.05rem;">Python<sup>11</sup></a><a href="/tags/SAR/" style="font-size: 1.05rem;">SAR<sup>2</sup></a><a href="/tags/Sentinel5/" style="font-size: 1.05rem;">Sentinel5<sup>3</sup></a><a href="/tags/arcgis/" style="font-size: 1.05rem;">arcgis<sup>1</sup></a><a href="/tags/cpp/" style="font-size: 1.05rem;">cpp<sup>2</sup></a><a href="/tags/deep-learn/" style="font-size: 1.05rem;">deep_learn<sup>1</sup></a><a href="/tags/ffmpeg/" style="font-size: 1.05rem;">ffmpeg<sup>1</sup></a><a href="/tags/gdal/" style="font-size: 1.05rem;">gdal<sup>5</sup></a><a href="/tags/gis/" style="font-size: 1.05rem;">gis<sup>4</sup></a><a href="/tags/golang/" style="font-size: 1.05rem;">golang<sup>1</sup></a><a href="/tags/himawari8/" style="font-size: 1.05rem;">himawari8<sup>1</sup></a><a href="/tags/kotlin/" style="font-size: 1.05rem;">kotlin<sup>3</sup></a><a href="/tags/leetcode/" style="font-size: 1.05rem;">leetcode<sup>1</sup></a><a href="/tags/linux/" style="font-size: 1.05rem;">linux<sup>6</sup></a><a href="/tags/matlab/" style="font-size: 1.05rem;">matlab<sup>4</sup></a><a href="/tags/pyside6/" style="font-size: 1.05rem;">pyside6<sup>2</sup></a><a href="/tags/python/" style="font-size: 1.05rem;">python<sup>47</sup></a><a href="/tags/rust/" style="font-size: 1.05rem;">rust<sup>1</sup></a><a href="/tags/sar/" style="font-size: 1.05rem;">sar<sup>5</sup></a><a href="/tags/shp/" style="font-size: 1.05rem;">shp<sup>1</sup></a><a href="/tags/vs/" style="font-size: 1.05rem;">vs<sup>1</sup></a><a href="/tags/%E4%B8%8B%E8%BD%BD/" style="font-size: 1.05rem;">下载<sup>1</sup></a><a href="/tags/%E5%8C%80%E8%89%B2/" style="font-size: 1.05rem;">匀色<sup>1</sup></a><a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 1.05rem;">工具<sup>2</sup></a><a href="/tags/%E6%8A%80%E6%9C%AF/" style="font-size: 1.05rem;">技术<sup>3</sup></a><a href="/tags/%E6%A1%88%E4%BB%B6/" style="font-size: 1.05rem;">案件<sup>1</sup></a><a href="/tags/%E6%B3%A8%E5%86%8C%E6%B5%8B%E7%BB%98%E5%B8%88/" style="font-size: 1.05rem;">注册测绘师<sup>13</sup></a><a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" style="font-size: 1.05rem;">深度学习<sup>15</sup></a><a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 1.05rem;">爬虫<sup>1</sup></a><a href="/tags/%E7%9F%A2%E9%87%8F/" style="font-size: 1.05rem;">矢量<sup>26</sup></a><a href="/tags/%E7%BB%98%E5%9B%BE/" style="font-size: 1.05rem;">绘图<sup>1</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B/" style="font-size: 1.05rem;">编程<sup>19</sup></a><a href="/tags/%E9%81%A5%E6%84%9F/" style="font-size: 1.05rem;">遥感<sup>183</sup></a><a href="/tags/%E9%81%A5%E6%84%9F-%E7%9F%A2%E9%87%8F/" style="font-size: 1.05rem;">遥感,矢量<sup>1</sup></a><a href="/tags/%E9%97%B2%E8%81%8A/" style="font-size: 1.05rem;">闲聊<sup>2</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">10</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">五月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">19</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">四月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">12</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">14</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">13</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%81%A5%E6%84%9F/" itemprop="url">遥感</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E9%81%A5%E6%84%9F/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>遥感</span></a></span></div></div><h1 class="post-title" itemprop="name headline">GDAL_OGR简单的使用教程</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-07-10T12:20:10.000Z" title="发表于 2025-07-10 20:20:10">2025-07-10</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-07-17T02:16:07.083Z" title="更新于 2025-07-17 10:16:07">2025-07-17</time></span></div><div class="meta-secondline"><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为广州"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>广州</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://cdn.jsdelivr.net/gh/ytkz11/picture/imgs202507161641982.png"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://ytkz11@.github.io/2025/07/10/gdal-ogr-jian-dan-de-shi-yong-jiao-cheng/"><header><a class="post-meta-categories" href="/categories/%E9%81%A5%E6%84%9F/" itemprop="url">遥感</a><a href="/tags/%E9%81%A5%E6%84%9F/" tabindex="-1" itemprop="url">遥感</a><h1 id="CrawlerTitle" itemprop="name headline">GDAL_OGR简单的使用教程</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">ytkz</span><time itemprop="dateCreated datePublished" datetime="2025-07-10T12:20:10.000Z" title="发表于 2025-07-10 20:20:10">2025-07-10</time><time itemprop="dateCreated datePublished" datetime="2025-07-17T02:16:07.083Z" title="更新于 2025-07-17 10:16:07">2025-07-17</time></header><h1 id="GDAL-OGR简单的使用教程"><a href="#GDAL-OGR简单的使用教程" class="headerlink" title="GDAL_OGR简单的使用教程"></a>GDAL_OGR简单的使用教程</h1><h2 id="检测安装"><a href="#检测安装" class="headerlink" title="检测安装"></a>检测安装</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> gdal<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="查看版本"><a href="#查看版本" class="headerlink" title="查看版本"></a>查看版本</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python">gdal<span class="token punctuation">.</span>VersionInfo<span class="token punctuation">(</span><span class="token string">'VERSION_NUM'</span><span class="token punctuation">)</span>

<span class="token comment"># '2040100'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="开启python异常"><a href="#开启python异常" class="headerlink" title="开启python异常"></a>开启python异常</h2><p>默认情况下，发生错误时，GDAL/OGR Python绑定不会引发异常。相反，它们返回错误值（例如None），并将错误消息写入sys.stdout。你可以通过调用UseExceptions()函数来开启异常：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> gdal

<span class="token comment"># 开启异常</span>
gdal<span class="token punctuation">.</span>UseExceptions<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 打开不存在的数据集</span>
ds <span class="token operator">=</span> gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span><span class="token string">'test.tif'</span><span class="token punctuation">)</span>

<span class="token comment"># 开启异常前</span>
ERROR <span class="token number">4</span><span class="token punctuation">:</span> test<span class="token punctuation">.</span>tif<span class="token punctuation">:</span> No such <span class="token builtin">file</span> <span class="token keyword">or</span> directory
<span class="token comment"># 开启异常后</span>
RuntimeError                              Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>
<span class="token operator">&lt;</span>ipython<span class="token operator">-</span><span class="token builtin">input</span><span class="token operator">-</span><span class="token number">5</span><span class="token operator">-</span><span class="token number">6ef000fdc647</span><span class="token operator">&gt;</span> <span class="token keyword">in</span> <span class="token operator">&lt;</span>module<span class="token operator">&gt;</span>
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">1</span> gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span><span class="token string">"test.tif"</span><span class="token punctuation">)</span>

c<span class="token punctuation">:</span>\program files\python37\lib\site<span class="token operator">-</span>packages\osgeo\gdal<span class="token punctuation">.</span>py <span class="token keyword">in</span> Open<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span>
   <span class="token number">3114</span> <span class="token keyword">def</span> <span class="token function">Open</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span><span class="token punctuation">:</span>
   <span class="token number">3115</span>     <span class="token triple-quoted-string string">"""Open(char const * utf8_path, GDALAccess eAccess) -&gt; Dataset"""</span>
<span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token number">3116</span>     <span class="token keyword">return</span> _gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">)</span>
   <span class="token number">3117</span>
   <span class="token number">3118</span> <span class="token keyword">def</span> <span class="token function">OpenEx</span><span class="token punctuation">(</span><span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>

RuntimeError<span class="token punctuation">:</span> test<span class="token punctuation">.</span>tif<span class="token punctuation">:</span> No such <span class="token builtin">file</span> <span class="token keyword">or</span> directory<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>你可以在运行的任何时候使用以下命令禁用GDAL/OGR异常：</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">gdal<span class="token punctuation">.</span>DontUseExceptions<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="安装GDAL-OGR错误处理"><a href="#安装GDAL-OGR错误处理" class="headerlink" title="安装GDAL OGR错误处理"></a>安装GDAL OGR错误处理</h2><p>安装GDAL错误处理程序功能，以捕获GDAL错误、类和消息。仅适用于GDAL 1.10以上的版本。</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr<span class="token punctuation">,</span> osr<span class="token punctuation">,</span> gdal

<span class="token comment"># GDAL错误处理方法</span>
<span class="token keyword">def</span> <span class="token function">gdal_error_handler</span><span class="token punctuation">(</span>err_class<span class="token punctuation">,</span> err_num<span class="token punctuation">,</span> err_msg<span class="token punctuation">)</span><span class="token punctuation">:</span>
    errtype <span class="token operator">=</span> <span class="token punctuation">{</span>
            gdal<span class="token punctuation">.</span>CE_None<span class="token punctuation">:</span><span class="token string">'None'</span><span class="token punctuation">,</span>
            gdal<span class="token punctuation">.</span>CE_Debug<span class="token punctuation">:</span><span class="token string">'Debug'</span><span class="token punctuation">,</span>
            gdal<span class="token punctuation">.</span>CE_Warning<span class="token punctuation">:</span><span class="token string">'Warning'</span><span class="token punctuation">,</span>
            gdal<span class="token punctuation">.</span>CE_Failure<span class="token punctuation">:</span><span class="token string">'Failure'</span><span class="token punctuation">,</span>
            gdal<span class="token punctuation">.</span>CE_Fatal<span class="token punctuation">:</span><span class="token string">'Fatal'</span>
    <span class="token punctuation">}</span>
    err_msg <span class="token operator">=</span> err_msg<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">,</span><span class="token string">' '</span><span class="token punctuation">)</span>
    err_class <span class="token operator">=</span> errtype<span class="token punctuation">.</span>get<span class="token punctuation">(</span>err_class<span class="token punctuation">,</span> <span class="token string">'None'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Error Number: %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>err_num<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Error Type: %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>err_class<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Error Message: %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>err_msg<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">'__main__'</span><span class="token punctuation">:</span>

    <span class="token comment"># 安装错误处理</span>
    gdal<span class="token punctuation">.</span>PushErrorHandler<span class="token punctuation">(</span>gdal_error_handler<span class="token punctuation">)</span>

    <span class="token comment"># 抛出一个假的错误</span>
    gdal<span class="token punctuation">.</span>Error<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'test error'</span><span class="token punctuation">)</span>

    <span class="token comment"># 卸载错误处理</span>
    gdal<span class="token punctuation">.</span>PopErrorHandler<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="栅格图层"><a href="#栅格图层" class="headerlink" title="栅格图层"></a>栅格图层</h1><h2 id="关闭栅格数据"><a href="#关闭栅格数据" class="headerlink" title="关闭栅格数据"></a>关闭栅格数据</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> gdal

<span class="token comment"># 打开数据</span>
ds <span class="token operator">=</span> gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span><span class="token string">'test.tif'</span><span class="token punctuation">)</span>

<span class="token comment"># 关闭数据（非必须）</span>
ds <span class="token operator">=</span> <span class="token boolean">None</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="获取元数据"><a href="#获取元数据" class="headerlink" title="获取元数据"></a>获取元数据</h2><pre class="line-numbers language-none"><code class="language-none">from osgeo import gdal
gtif = gdal.Open( "merge.tif" )
print (gtif.GetMetadata())<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="波段融合"><a href="#波段融合" class="headerlink" title="波段融合"></a>波段融合</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> gdal
<span class="token comment"># 打开数据</span>
ds1<span class="token operator">=</span>gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span><span class="token string">"LM51130321998341HAJ00_B1.TIF"</span><span class="token punctuation">)</span>
ds2<span class="token operator">=</span>gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span><span class="token string">"LM51130321998341HAJ00_B2.TIF"</span><span class="token punctuation">)</span>
ds3<span class="token operator">=</span>gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span><span class="token string">"LM51130321998341HAJ00_B3.TIF"</span><span class="token punctuation">)</span>
ds4<span class="token operator">=</span>gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span><span class="token string">"LM51130321998341HAJ00_B4.TIF"</span><span class="token punctuation">)</span>
<span class="token comment"># 获取波段</span>
b1<span class="token operator">=</span>ds1<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
b2<span class="token operator">=</span>ds1<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
b3<span class="token operator">=</span>ds1<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
b4<span class="token operator">=</span>ds1<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment"># 创建数据</span>
driver<span class="token operator">=</span>gdal<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">"GTiff"</span><span class="token punctuation">)</span>
out_ds<span class="token operator">=</span>driver<span class="token punctuation">.</span>Create<span class="token punctuation">(</span><span class="token string">'merge.tif'</span><span class="token punctuation">,</span>ds1<span class="token punctuation">.</span>RasterXSize<span class="token punctuation">,</span>ds1<span class="token punctuation">.</span>RasterYSize<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span>gdal<span class="token punctuation">.</span>GDT_Byte<span class="token punctuation">)</span>
<span class="token comment"># 设置坐标和投影</span>
out_ds<span class="token punctuation">.</span>SetGeoTransform<span class="token punctuation">(</span>ds1<span class="token punctuation">.</span>GetGeoTransform<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
out_ds<span class="token punctuation">.</span>SetProjection<span class="token punctuation">(</span>ds1<span class="token punctuation">.</span>GetProjection<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

ob1<span class="token operator">=</span>out_ds<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
ob2<span class="token operator">=</span>out_ds<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
ob3<span class="token operator">=</span>out_ds<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
ob4<span class="token operator">=</span>out_ds<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
<span class="token comment"># 写入数据</span>
ob1<span class="token punctuation">.</span>WriteArray<span class="token punctuation">(</span>b1<span class="token punctuation">.</span>ReadAsArray<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ob2<span class="token punctuation">.</span>WriteArray<span class="token punctuation">(</span>b2<span class="token punctuation">.</span>ReadAsArray<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ob3<span class="token punctuation">.</span>WriteArray<span class="token punctuation">(</span>b3<span class="token punctuation">.</span>ReadAsArray<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ob4<span class="token punctuation">.</span>WriteArray<span class="token punctuation">(</span>b4<span class="token punctuation">.</span>ReadAsArray<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

out_ds<span class="token operator">=</span><span class="token boolean">None</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="获取波段"><a href="#获取波段" class="headerlink" title="获取波段"></a>获取波段</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> gdal
<span class="token keyword">import</span> sys
<span class="token comment"># 允许python异常</span>
gdal<span class="token punctuation">.</span>UseExceptions<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
    src_ds <span class="token operator">=</span> gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span> <span class="token string">"merge.tif"</span> <span class="token punctuation">)</span>
<span class="token keyword">except</span> RuntimeError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
    srcband <span class="token operator">=</span> src_ds<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> RuntimeError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token comment"># 试一下 GetRasterBand(10)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="遍历波段"><a href="#遍历波段" class="headerlink" title="遍历波段"></a>遍历波段</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> gdal
<span class="token keyword">import</span> sys

src_ds <span class="token operator">=</span> gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span> <span class="token string">"merge.tif"</span> <span class="token punctuation">)</span>

<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"波段个数: "</span><span class="token punctuation">,</span> src_ds<span class="token punctuation">.</span>RasterCount<span class="token punctuation">)</span>
<span class="token keyword">for</span> band <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span> src_ds<span class="token punctuation">.</span>RasterCount <span class="token punctuation">)</span><span class="token punctuation">:</span>
    band <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"获取波段: "</span><span class="token punctuation">,</span> band<span class="token punctuation">)</span>
    srcband <span class="token operator">=</span> src_ds<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span>band<span class="token punctuation">)</span>
    <span class="token keyword">if</span> srcband <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">continue</span>

    stats <span class="token operator">=</span> srcband<span class="token punctuation">.</span>GetStatistics<span class="token punctuation">(</span> <span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token boolean">True</span> <span class="token punctuation">)</span>
    <span class="token keyword">if</span> stats <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">continue</span>

    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"[ STATS ] =  Minimum=%.3f, Maximum=%.3f, Mean=%.3f, StdDev=%.3f"</span> <span class="token operator">%</span> <span class="token punctuation">(</span> \
                stats<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> stats<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> stats<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> stats<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="获取波段信息"><a href="#获取波段信息" class="headerlink" title="获取波段信息"></a>获取波段信息</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> gdal
<span class="token keyword">import</span> sys
gdal<span class="token punctuation">.</span>UseExceptions<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span> band_num<span class="token punctuation">,</span> input_file <span class="token punctuation">)</span><span class="token punctuation">:</span>
    src_ds <span class="token operator">=</span> gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span> input_file <span class="token punctuation">)</span>

    <span class="token keyword">try</span><span class="token punctuation">:</span>
        srcband <span class="token operator">=</span> src_ds<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span>band_num<span class="token punctuation">)</span>
    <span class="token keyword">except</span> RuntimeError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span> e<span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>


    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"[ NO DATA VALUE ] = "</span><span class="token punctuation">,</span> srcband<span class="token punctuation">.</span>GetNoDataValue<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"[ MIN ] = "</span><span class="token punctuation">,</span> srcband<span class="token punctuation">.</span>GetMinimum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"[ MAX ] = "</span><span class="token punctuation">,</span> srcband<span class="token punctuation">.</span>GetMaximum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"[ SCALE ] = "</span><span class="token punctuation">,</span> srcband<span class="token punctuation">.</span>GetScale<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span> <span class="token string">"[ UNIT TYPE ] = "</span><span class="token punctuation">,</span> srcband<span class="token punctuation">.</span>GetUnitType<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    ctable <span class="token operator">=</span> srcband<span class="token punctuation">.</span>GetColorTable<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> ctable <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'No ColorTable found'</span><span class="token punctuation">)</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"[ COLOR TABLE COUNT ] = "</span><span class="token punctuation">,</span> ctable<span class="token punctuation">.</span>GetCount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span> <span class="token number">0</span><span class="token punctuation">,</span> ctable<span class="token punctuation">.</span>GetCount<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">:</span>
        entry <span class="token operator">=</span> ctable<span class="token punctuation">.</span>GetColorEntry<span class="token punctuation">(</span> i <span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> entry<span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"[ COLOR ENTRY RGB ] = "</span><span class="token punctuation">,</span> ctable<span class="token punctuation">.</span>GetColorEntryAsRGB<span class="token punctuation">(</span> i<span class="token punctuation">,</span> entry <span class="token punctuation">)</span><span class="token punctuation">)</span>

main<span class="token punctuation">(</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"merge.tif"</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="多边形化栅格波段"><a href="#多边形化栅格波段" class="headerlink" title="多边形化栅格波段"></a>多边形化栅格波段</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> gdal<span class="token punctuation">,</span> ogr
<span class="token keyword">import</span> sys

gdal<span class="token punctuation">.</span>UseExceptions<span class="token punctuation">(</span><span class="token punctuation">)</span>

src_ds <span class="token operator">=</span> gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span> <span class="token string">"test.tif"</span> <span class="token punctuation">)</span>

srcband <span class="token operator">=</span> src_ds<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>

dst_layername <span class="token operator">=</span> <span class="token string">"POLYGONIZED_STUFF"</span>
drv <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">"ESRI Shapefile"</span><span class="token punctuation">)</span>
dst_ds <span class="token operator">=</span> drv<span class="token punctuation">.</span>CreateDataSource<span class="token punctuation">(</span> dst_layername <span class="token operator">+</span> <span class="token string">".shp"</span> <span class="token punctuation">)</span>
dst_layer <span class="token operator">=</span> dst_ds<span class="token punctuation">.</span>CreateLayer<span class="token punctuation">(</span>dst_layername<span class="token punctuation">,</span> srs <span class="token operator">=</span> <span class="token boolean">None</span> <span class="token punctuation">)</span>

gdal<span class="token punctuation">.</span>Polygonize<span class="token punctuation">(</span> srcband<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> dst_layer<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> callback<span class="token operator">=</span><span class="token boolean">None</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="栅格化矢量数据"><a href="#栅格化矢量数据" class="headerlink" title="栅格化矢量数据"></a>栅格化矢量数据</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> gdal<span class="token punctuation">,</span> ogr

<span class="token comment"># 定义像素大小和无效值</span>
pixel_size <span class="token operator">=</span> <span class="token number">25</span>
NoData_value <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">9999</span>

vector_fn <span class="token operator">=</span> <span class="token string">'test.shp'</span>

raster_fn <span class="token operator">=</span> <span class="token string">'test.tif'</span>

<span class="token comment"># 打开数据并读取范围</span>
source_ds <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>vector_fn<span class="token punctuation">)</span>
source_layer <span class="token operator">=</span> source_ds<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>
x_min<span class="token punctuation">,</span> x_max<span class="token punctuation">,</span> y_min<span class="token punctuation">,</span> y_max <span class="token operator">=</span> source_layer<span class="token punctuation">.</span>GetExtent<span class="token punctuation">(</span><span class="token punctuation">)</span>

x_res <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x_max <span class="token operator">-</span> x_min<span class="token punctuation">)</span> <span class="token operator">/</span> pixel_size<span class="token punctuation">)</span>
y_res <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y_max <span class="token operator">-</span> y_min<span class="token punctuation">)</span> <span class="token operator">/</span> pixel_size<span class="token punctuation">)</span>
target_ds <span class="token operator">=</span> gdal<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">'GTiff'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Create<span class="token punctuation">(</span>raster_fn<span class="token punctuation">,</span> x_res<span class="token punctuation">,</span> y_res<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> gdal<span class="token punctuation">.</span>GDT_Byte<span class="token punctuation">)</span>
target_ds<span class="token punctuation">.</span>SetGeoTransform<span class="token punctuation">(</span><span class="token punctuation">(</span>x_min<span class="token punctuation">,</span> pixel_size<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> y_max<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>pixel_size<span class="token punctuation">)</span><span class="token punctuation">)</span>
band <span class="token operator">=</span> target_ds<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
band<span class="token punctuation">.</span>SetNoDataValue<span class="token punctuation">(</span>NoData_value<span class="token punctuation">)</span>

<span class="token comment"># 栅格化</span>
gdal<span class="token punctuation">.</span>RasterizeLayer<span class="token punctuation">(</span>target_ds<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> source_layer<span class="token punctuation">,</span> burn_values<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="用shapefile裁剪栅格"><a href="#用shapefile裁剪栅格" class="headerlink" title="用shapefile裁剪栅格"></a>用shapefile裁剪栅格</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> gdal<span class="token punctuation">,</span> gdalnumeric<span class="token punctuation">,</span> ogr<span class="token punctuation">,</span> osr
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token punctuation">,</span> ImageDraw
<span class="token keyword">import</span> os<span class="token punctuation">,</span> sys
gdal<span class="token punctuation">.</span>UseExceptions<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">imageToArray</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Image转换为数组.
    """</span>
    a<span class="token operator">=</span>gdalnumeric<span class="token punctuation">.</span>fromstring<span class="token punctuation">(</span>i<span class="token punctuation">.</span>tostring<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">)</span>
    a<span class="token punctuation">.</span>shape<span class="token operator">=</span>i<span class="token punctuation">.</span>im<span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">.</span>im<span class="token punctuation">.</span>size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">return</span> a

<span class="token keyword">def</span> <span class="token function">arrayToImage</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
   数组转换为Image.
    """</span>
    i<span class="token operator">=</span>Image<span class="token punctuation">.</span>fromstring<span class="token punctuation">(</span><span class="token string">'L'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>a<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">(</span>a<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>tostring<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> i

<span class="token keyword">def</span> <span class="token function">world2Pixel</span><span class="token punctuation">(</span>geoMatrix<span class="token punctuation">,</span> x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token triple-quoted-string string">"""
  用地理仿射变换计算像素坐标
  """</span>
  ulX <span class="token operator">=</span> geoMatrix<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  ulY <span class="token operator">=</span> geoMatrix<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
  xDist <span class="token operator">=</span> geoMatrix<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
  yDist <span class="token operator">=</span> geoMatrix<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>
  rtnX <span class="token operator">=</span> geoMatrix<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
  rtnY <span class="token operator">=</span> geoMatrix<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span>
  pixel <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">-</span> ulX<span class="token punctuation">)</span> <span class="token operator">/</span> xDist<span class="token punctuation">)</span>
  line <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ulY <span class="token operator">-</span> y<span class="token punctuation">)</span> <span class="token operator">/</span> xDist<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>pixel<span class="token punctuation">,</span> line<span class="token punctuation">)</span>

<span class="token comment">#</span>
<span class="token comment">#  EDIT: this is basically an overloaded</span>
<span class="token comment">#  version of the gdal_array.OpenArray passing in xoff, yoff explicitly</span>
<span class="token comment">#  so we can pass these params off to CopyDatasetInfo</span>
<span class="token comment">#</span>
<span class="token keyword">def</span> <span class="token function">OpenArray</span><span class="token punctuation">(</span> array<span class="token punctuation">,</span> prototype_ds <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span> xoff<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> yoff<span class="token operator">=</span><span class="token number">0</span> <span class="token punctuation">)</span><span class="token punctuation">:</span>
    ds <span class="token operator">=</span> gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span> gdalnumeric<span class="token punctuation">.</span>GetArrayFilename<span class="token punctuation">(</span>array<span class="token punctuation">)</span> <span class="token punctuation">)</span>

    <span class="token keyword">if</span> ds <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span> <span class="token keyword">and</span> prototype_ds <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">type</span><span class="token punctuation">(</span>prototype_ds<span class="token punctuation">)</span><span class="token punctuation">.</span>__name__ <span class="token operator">==</span> <span class="token string">'str'</span><span class="token punctuation">:</span>
            prototype_ds <span class="token operator">=</span> gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span> prototype_ds <span class="token punctuation">)</span>
        <span class="token keyword">if</span> prototype_ds <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
            gdalnumeric<span class="token punctuation">.</span>CopyDatasetInfo<span class="token punctuation">(</span> prototype_ds<span class="token punctuation">,</span> ds<span class="token punctuation">,</span> xoff<span class="token operator">=</span>xoff<span class="token punctuation">,</span> yoff<span class="token operator">=</span>yoff <span class="token punctuation">)</span>
    <span class="token keyword">return</span> ds

<span class="token keyword">def</span> <span class="token function">histogram</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> bins<span class="token operator">=</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token triple-quoted-string string">"""
  Histogram function for multi-dimensional array.
  a = array
  bins = range of numbers to match
  """</span>
  fa <span class="token operator">=</span> a<span class="token punctuation">.</span>flat
  n <span class="token operator">=</span> gdalnumeric<span class="token punctuation">.</span>searchsorted<span class="token punctuation">(</span>gdalnumeric<span class="token punctuation">.</span>sort<span class="token punctuation">(</span>fa<span class="token punctuation">)</span><span class="token punctuation">,</span> bins<span class="token punctuation">)</span>
  n <span class="token operator">=</span> gdalnumeric<span class="token punctuation">.</span>concatenate<span class="token punctuation">(</span><span class="token punctuation">[</span>n<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token builtin">len</span><span class="token punctuation">(</span>fa<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  hist <span class="token operator">=</span> n<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token operator">-</span>n<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
  <span class="token keyword">return</span> hist

<span class="token keyword">def</span> <span class="token function">stretch</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token triple-quoted-string string">"""
  Performs a histogram stretch on a gdalnumeric array image.
  """</span>
  hist <span class="token operator">=</span> histogram<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
  im <span class="token operator">=</span> arrayToImage<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
  lut <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">for</span> b <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>hist<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># step size</span>
    step <span class="token operator">=</span> <span class="token builtin">reduce</span><span class="token punctuation">(</span>operator<span class="token punctuation">.</span>add<span class="token punctuation">,</span> hist<span class="token punctuation">[</span>b<span class="token punctuation">:</span>b<span class="token operator">+</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">255</span>
    <span class="token comment"># create equalization lookup table</span>
    n <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
      lut<span class="token punctuation">.</span>append<span class="token punctuation">(</span>n <span class="token operator">/</span> step<span class="token punctuation">)</span>
      n <span class="token operator">=</span> n <span class="token operator">+</span> hist<span class="token punctuation">[</span>i<span class="token operator">+</span>b<span class="token punctuation">]</span>
  im <span class="token operator">=</span> im<span class="token punctuation">.</span>point<span class="token punctuation">(</span>lut<span class="token punctuation">)</span>
  <span class="token keyword">return</span> imageToArray<span class="token punctuation">(</span>im<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span> shapefile_path<span class="token punctuation">,</span> raster_path <span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 读取数据到数组</span>
    srcArray <span class="token operator">=</span> gdalnumeric<span class="token punctuation">.</span>LoadFile<span class="token punctuation">(</span>raster_path<span class="token punctuation">)</span>

    <span class="token comment"># 获取地理仿射变换</span>
    srcImage <span class="token operator">=</span> gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>raster_path<span class="token punctuation">)</span>
    geoTrans <span class="token operator">=</span> srcImage<span class="token punctuation">.</span>GetGeoTransform<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 获取矢量图层</span>
    shapef <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>shapefile_path<span class="token punctuation">)</span>
    lyr <span class="token operator">=</span> shapef<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>split<span class="token punctuation">(</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span> shapefile_path <span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
    poly <span class="token operator">=</span> lyr<span class="token punctuation">.</span>GetNextFeature<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 获取范围</span>
    minX<span class="token punctuation">,</span> maxX<span class="token punctuation">,</span> minY<span class="token punctuation">,</span> maxY <span class="token operator">=</span> lyr<span class="token punctuation">.</span>GetExtent<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ulX<span class="token punctuation">,</span> ulY <span class="token operator">=</span> world2Pixel<span class="token punctuation">(</span>geoTrans<span class="token punctuation">,</span> minX<span class="token punctuation">,</span> maxY<span class="token punctuation">)</span>
    lrX<span class="token punctuation">,</span> lrY <span class="token operator">=</span> world2Pixel<span class="token punctuation">(</span>geoTrans<span class="token punctuation">,</span> maxX<span class="token punctuation">,</span> minY<span class="token punctuation">)</span>

    <span class="token comment"># 计算像素大小</span>
    pxWidth <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>lrX <span class="token operator">-</span> ulX<span class="token punctuation">)</span>
    pxHeight <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>lrY <span class="token operator">-</span> ulY<span class="token punctuation">)</span>

    clip <span class="token operator">=</span> srcArray<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> ulY<span class="token punctuation">:</span>lrY<span class="token punctuation">,</span> ulX<span class="token punctuation">:</span>lrX<span class="token punctuation">]</span>

    <span class="token comment">#</span>
    <span class="token comment"># 像素偏移</span>
    <span class="token comment">#</span>
    xoffset <span class="token operator">=</span>  ulX
    yoffset <span class="token operator">=</span>  ulY
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"Xoffset, Yoffset = ( %f, %f )"</span> <span class="token operator">%</span> <span class="token punctuation">(</span> xoffset<span class="token punctuation">,</span> yoffset <span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 创建新的仿射变换</span>
    geoTrans <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>geoTrans<span class="token punctuation">)</span>
    geoTrans<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> minX
    geoTrans<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> maxY

    <span class="token comment"># Map points to pixels for drawing the</span>
    <span class="token comment"># boundary on a blank 8-bit,</span>
    <span class="token comment"># black and white, mask image.</span>
    points <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    pixels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    geom <span class="token operator">=</span> poly<span class="token punctuation">.</span>GetGeometryRef<span class="token punctuation">(</span><span class="token punctuation">)</span>
    pts <span class="token operator">=</span> geom<span class="token punctuation">.</span>GetGeometryRef<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> p <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>pts<span class="token punctuation">.</span>GetPointCount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
      points<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">(</span>pts<span class="token punctuation">.</span>GetX<span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">,</span> pts<span class="token punctuation">.</span>GetY<span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> p <span class="token keyword">in</span> points<span class="token punctuation">:</span>
      pixels<span class="token punctuation">.</span>append<span class="token punctuation">(</span>world2Pixel<span class="token punctuation">(</span>geoTrans<span class="token punctuation">,</span> p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    rasterPoly <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>pxWidth<span class="token punctuation">,</span> pxHeight<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
    rasterize <span class="token operator">=</span> ImageDraw<span class="token punctuation">.</span>Draw<span class="token punctuation">(</span>rasterPoly<span class="token punctuation">)</span>
    rasterize<span class="token punctuation">.</span>polygon<span class="token punctuation">(</span>pixels<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    mask <span class="token operator">=</span> imageToArray<span class="token punctuation">(</span>rasterPoly<span class="token punctuation">)</span>

    <span class="token comment"># Clip the image using the mask</span>
    clip <span class="token operator">=</span> gdalnumeric<span class="token punctuation">.</span>choose<span class="token punctuation">(</span>mask<span class="token punctuation">,</span> \
        <span class="token punctuation">(</span>clip<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>gdalnumeric<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>

    <span class="token comment"># This image has 3 bands so we stretch each one to make them</span>
    <span class="token comment"># visually brighter</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
      clip<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">=</span> stretch<span class="token punctuation">(</span>clip<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># Save new tiff</span>
    <span class="token comment">#</span>
    <span class="token comment">#  EDIT: instead of SaveArray, let's break all the</span>
    <span class="token comment">#  SaveArray steps out more explicity so</span>
    <span class="token comment">#  we can overwrite the offset of the destination</span>
    <span class="token comment">#  raster</span>
    <span class="token comment">#</span>
    <span class="token comment">### the old way using SaveArray</span>
    <span class="token comment">#</span>
    <span class="token comment"># gdalnumeric.SaveArray(clip, "OUTPUT.tif", format="GTiff", prototype=raster_path)</span>
    <span class="token comment">#</span>
    <span class="token comment">###</span>
    <span class="token comment">#</span>
    gtiffDriver <span class="token operator">=</span> gdal<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span> <span class="token string">'GTiff'</span> <span class="token punctuation">)</span>
    <span class="token keyword">if</span> gtiffDriver <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> ValueError<span class="token punctuation">(</span><span class="token string">"Can't find GeoTiff Driver"</span><span class="token punctuation">)</span>
    gtiffDriver<span class="token punctuation">.</span>CreateCopy<span class="token punctuation">(</span> <span class="token string">"OUTPUT.tif"</span><span class="token punctuation">,</span>
        OpenArray<span class="token punctuation">(</span> clip<span class="token punctuation">,</span> prototype_ds<span class="token operator">=</span>raster_path<span class="token punctuation">,</span> xoff<span class="token operator">=</span>xoffset<span class="token punctuation">,</span> yoff<span class="token operator">=</span>yoffset <span class="token punctuation">)</span>
    <span class="token punctuation">)</span>

    <span class="token comment"># Save as an 8-bit jpeg for an easy, quick preview</span>
    clip <span class="token operator">=</span> clip<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>gdalnumeric<span class="token punctuation">.</span>uint8<span class="token punctuation">)</span>
    gdalnumeric<span class="token punctuation">.</span>SaveArray<span class="token punctuation">(</span>clip<span class="token punctuation">,</span> <span class="token string">"OUTPUT.jpg"</span><span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">"JPEG"</span><span class="token punctuation">)</span>

    gdal<span class="token punctuation">.</span>ErrorReset<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>

    <span class="token comment">#</span>
    <span class="token comment"># example run : $ python clip.py /&lt;full-path&gt;/&lt;shapefile-name&gt;.shp /&lt;full-path&gt;/&lt;raster-name&gt;.tif</span>
    <span class="token comment">#</span>
    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span> sys<span class="token punctuation">.</span>argv <span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"[ ERROR ] you must two args. 1) the full shapefile path and 2) the full raster path"</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span>

    main<span class="token punctuation">(</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="区域统计"><a href="#区域统计" class="headerlink" title="区域统计"></a>区域统计</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gdal<span class="token punctuation">,</span> ogr<span class="token punctuation">,</span> osr<span class="token punctuation">,</span> numpy
<span class="token keyword">import</span> sys


<span class="token keyword">def</span> <span class="token function">zonal_stats</span><span class="token punctuation">(</span>feat<span class="token punctuation">,</span> input_zone_polygon<span class="token punctuation">,</span> input_value_raster<span class="token punctuation">)</span><span class="token punctuation">:</span>

    <span class="token comment"># Open data</span>
    raster <span class="token operator">=</span> gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>input_value_raster<span class="token punctuation">)</span>
    shp <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>input_zone_polygon<span class="token punctuation">)</span>
    lyr <span class="token operator">=</span> shp<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># Get raster georeference info</span>
    transform <span class="token operator">=</span> raster<span class="token punctuation">.</span>GetGeoTransform<span class="token punctuation">(</span><span class="token punctuation">)</span>
    xOrigin <span class="token operator">=</span> transform<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    yOrigin <span class="token operator">=</span> transform<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
    pixelWidth <span class="token operator">=</span> transform<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    pixelHeight <span class="token operator">=</span> transform<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>

    <span class="token comment"># Reproject vector geometry to same projection as raster</span>
    sourceSR <span class="token operator">=</span> lyr<span class="token punctuation">.</span>GetSpatialRef<span class="token punctuation">(</span><span class="token punctuation">)</span>
    targetSR <span class="token operator">=</span> osr<span class="token punctuation">.</span>SpatialReference<span class="token punctuation">(</span><span class="token punctuation">)</span>
    targetSR<span class="token punctuation">.</span>ImportFromWkt<span class="token punctuation">(</span>raster<span class="token punctuation">.</span>GetProjectionRef<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    coordTrans <span class="token operator">=</span> osr<span class="token punctuation">.</span>CoordinateTransformation<span class="token punctuation">(</span>sourceSR<span class="token punctuation">,</span>targetSR<span class="token punctuation">)</span>
    feat <span class="token operator">=</span> lyr<span class="token punctuation">.</span>GetNextFeature<span class="token punctuation">(</span><span class="token punctuation">)</span>
    geom <span class="token operator">=</span> feat<span class="token punctuation">.</span>GetGeometryRef<span class="token punctuation">(</span><span class="token punctuation">)</span>
    geom<span class="token punctuation">.</span>Transform<span class="token punctuation">(</span>coordTrans<span class="token punctuation">)</span>

    <span class="token comment"># Get extent of feat</span>
    geom <span class="token operator">=</span> feat<span class="token punctuation">.</span>GetGeometryRef<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>geom<span class="token punctuation">.</span>GetGeometryName<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'MULTIPOLYGON'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        count <span class="token operator">=</span> <span class="token number">0</span>
        pointsX <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> pointsY <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> polygon <span class="token keyword">in</span> geom<span class="token punctuation">:</span>
            geomInner <span class="token operator">=</span> geom<span class="token punctuation">.</span>GetGeometryRef<span class="token punctuation">(</span>count<span class="token punctuation">)</span>
            ring <span class="token operator">=</span> geomInner<span class="token punctuation">.</span>GetGeometryRef<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
            numpoints <span class="token operator">=</span> ring<span class="token punctuation">.</span>GetPointCount<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> p <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>numpoints<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    lon<span class="token punctuation">,</span> lat<span class="token punctuation">,</span> z <span class="token operator">=</span> ring<span class="token punctuation">.</span>GetPoint<span class="token punctuation">(</span>p<span class="token punctuation">)</span>
                    pointsX<span class="token punctuation">.</span>append<span class="token punctuation">(</span>lon<span class="token punctuation">)</span>
                    pointsY<span class="token punctuation">.</span>append<span class="token punctuation">(</span>lat<span class="token punctuation">)</span>
            count <span class="token operator">+=</span> <span class="token number">1</span>
    <span class="token keyword">elif</span> <span class="token punctuation">(</span>geom<span class="token punctuation">.</span>GetGeometryName<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'POLYGON'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        ring <span class="token operator">=</span> geom<span class="token punctuation">.</span>GetGeometryRef<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        numpoints <span class="token operator">=</span> ring<span class="token punctuation">.</span>GetPointCount<span class="token punctuation">(</span><span class="token punctuation">)</span>
        pointsX <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span> pointsY <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> p <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>numpoints<span class="token punctuation">)</span><span class="token punctuation">:</span>
                lon<span class="token punctuation">,</span> lat<span class="token punctuation">,</span> z <span class="token operator">=</span> ring<span class="token punctuation">.</span>GetPoint<span class="token punctuation">(</span>p<span class="token punctuation">)</span>
                pointsX<span class="token punctuation">.</span>append<span class="token punctuation">(</span>lon<span class="token punctuation">)</span>
                pointsY<span class="token punctuation">.</span>append<span class="token punctuation">(</span>lat<span class="token punctuation">)</span>

    <span class="token keyword">else</span><span class="token punctuation">:</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token string">"ERROR: Geometry needs to be either Polygon or Multipolygon"</span><span class="token punctuation">)</span>

    xmin <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>pointsX<span class="token punctuation">)</span>
    xmax <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>pointsX<span class="token punctuation">)</span>
    ymin <span class="token operator">=</span> <span class="token builtin">min</span><span class="token punctuation">(</span>pointsY<span class="token punctuation">)</span>
    ymax <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span>pointsY<span class="token punctuation">)</span>

    <span class="token comment"># Specify offset and rows and columns to read</span>
    xoff <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>xmin <span class="token operator">-</span> xOrigin<span class="token punctuation">)</span><span class="token operator">/</span>pixelWidth<span class="token punctuation">)</span>
    yoff <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>yOrigin <span class="token operator">-</span> ymax<span class="token punctuation">)</span><span class="token operator">/</span>pixelWidth<span class="token punctuation">)</span>
    xcount <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>xmax <span class="token operator">-</span> xmin<span class="token punctuation">)</span><span class="token operator">/</span>pixelWidth<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span>
    ycount <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>ymax <span class="token operator">-</span> ymin<span class="token punctuation">)</span><span class="token operator">/</span>pixelWidth<span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span>

    <span class="token comment"># Create memory target raster</span>
    target_ds <span class="token operator">=</span> gdal<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">'MEM'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Create<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> xcount<span class="token punctuation">,</span> ycount<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> gdal<span class="token punctuation">.</span>GDT_Byte<span class="token punctuation">)</span>
    target_ds<span class="token punctuation">.</span>SetGeoTransform<span class="token punctuation">(</span><span class="token punctuation">(</span>
        xmin<span class="token punctuation">,</span> pixelWidth<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
        ymax<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pixelHeight<span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Create for target raster the same projection as for the value raster</span>
    raster_srs <span class="token operator">=</span> osr<span class="token punctuation">.</span>SpatialReference<span class="token punctuation">(</span><span class="token punctuation">)</span>
    raster_srs<span class="token punctuation">.</span>ImportFromWkt<span class="token punctuation">(</span>raster<span class="token punctuation">.</span>GetProjectionRef<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    target_ds<span class="token punctuation">.</span>SetProjection<span class="token punctuation">(</span>raster_srs<span class="token punctuation">.</span>ExportToWkt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Rasterize zone polygon to raster</span>
    gdal<span class="token punctuation">.</span>RasterizeLayer<span class="token punctuation">(</span>target_ds<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> lyr<span class="token punctuation">,</span> burn_values<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># Read raster as arrays</span>
    banddataraster <span class="token operator">=</span> raster<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    dataraster <span class="token operator">=</span> banddataraster<span class="token punctuation">.</span>ReadAsArray<span class="token punctuation">(</span>xoff<span class="token punctuation">,</span> yoff<span class="token punctuation">,</span> xcount<span class="token punctuation">,</span> ycount<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>numpy<span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">)</span>

    bandmask <span class="token operator">=</span> target_ds<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    datamask <span class="token operator">=</span> bandmask<span class="token punctuation">.</span>ReadAsArray<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> xcount<span class="token punctuation">,</span> ycount<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>numpy<span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">)</span>

    <span class="token comment"># Mask zone of raster</span>
    zoneraster <span class="token operator">=</span> numpy<span class="token punctuation">.</span>ma<span class="token punctuation">.</span>masked_array<span class="token punctuation">(</span>dataraster<span class="token punctuation">,</span>  numpy<span class="token punctuation">.</span>logical_not<span class="token punctuation">(</span>datamask<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Calculate statistics of zonal raster</span>
    <span class="token keyword">return</span> numpy<span class="token punctuation">.</span>average<span class="token punctuation">(</span>zoneraster<span class="token punctuation">)</span><span class="token punctuation">,</span>numpy<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>zoneraster<span class="token punctuation">)</span><span class="token punctuation">,</span>numpy<span class="token punctuation">.</span>median<span class="token punctuation">(</span>zoneraster<span class="token punctuation">)</span><span class="token punctuation">,</span>numpy<span class="token punctuation">.</span>std<span class="token punctuation">(</span>zoneraster<span class="token punctuation">)</span><span class="token punctuation">,</span>numpy<span class="token punctuation">.</span>var<span class="token punctuation">(</span>zoneraster<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">loop_zonal_stats</span><span class="token punctuation">(</span>input_zone_polygon<span class="token punctuation">,</span> input_value_raster<span class="token punctuation">)</span><span class="token punctuation">:</span>

    shp <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>input_zone_polygon<span class="token punctuation">)</span>
    lyr <span class="token operator">=</span> shp<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>
    featList <span class="token operator">=</span> <span class="token builtin">range</span><span class="token punctuation">(</span>lyr<span class="token punctuation">.</span>GetFeatureCount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    statDict <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

    <span class="token keyword">for</span> FID <span class="token keyword">in</span> featList<span class="token punctuation">:</span>
        feat <span class="token operator">=</span> lyr<span class="token punctuation">.</span>GetFeature<span class="token punctuation">(</span>FID<span class="token punctuation">)</span>
        meanValue <span class="token operator">=</span> zonal_stats<span class="token punctuation">(</span>feat<span class="token punctuation">,</span> input_zone_polygon<span class="token punctuation">,</span> input_value_raster<span class="token punctuation">)</span>
        statDict<span class="token punctuation">[</span>FID<span class="token punctuation">]</span> <span class="token operator">=</span> meanValue
    <span class="token keyword">return</span> statDict

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>input_zone_polygon<span class="token punctuation">,</span> input_value_raster<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> loop_zonal_stats<span class="token punctuation">(</span>input_zone_polygon<span class="token punctuation">,</span> input_value_raster<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>

    <span class="token comment">#</span>
    <span class="token comment"># Returns for each feature a dictionary item (FID) with the statistical values in the following order: Average, Mean, Medain, Standard Deviation, Variance</span>
    <span class="token comment">#</span>
    <span class="token comment"># example run : $ python grid.py &lt;full-path&gt;&lt;output-shapefile-name&gt;.shp xmin xmax ymin ymax gridHeight gridWidth</span>
    <span class="token comment">#</span>

    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span> sys<span class="token punctuation">.</span>argv <span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">3</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"[ ERROR ] you must supply two arguments: input-zone-shapefile-name.shp input-value-raster-name.tif "</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token string">'Returns for each feature a dictionary item (FID) with the statistical values in the following order: Average, Mean, Medain, Standard Deviation, Variance'</span>
    <span class="token keyword">print</span> main<span class="token punctuation">(</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="从数组创建栅格"><a href="#从数组创建栅格" class="headerlink" title="从数组创建栅格"></a>从数组创建栅格</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gdal<span class="token punctuation">,</span> ogr<span class="token punctuation">,</span> os<span class="token punctuation">,</span> osr
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np


<span class="token keyword">def</span> <span class="token function">array2raster</span><span class="token punctuation">(</span>newRasterfn<span class="token punctuation">,</span>rasterOrigin<span class="token punctuation">,</span>pixelWidth<span class="token punctuation">,</span>pixelHeight<span class="token punctuation">,</span>array<span class="token punctuation">)</span><span class="token punctuation">:</span>

    cols <span class="token operator">=</span> array<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    rows <span class="token operator">=</span> array<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    originX <span class="token operator">=</span> rasterOrigin<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    originY <span class="token operator">=</span> rasterOrigin<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>

    driver <span class="token operator">=</span> gdal<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">'GTiff'</span><span class="token punctuation">)</span>
    outRaster <span class="token operator">=</span> driver<span class="token punctuation">.</span>Create<span class="token punctuation">(</span>newRasterfn<span class="token punctuation">,</span> cols<span class="token punctuation">,</span> rows<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> gdal<span class="token punctuation">.</span>GDT_Byte<span class="token punctuation">)</span>
    outRaster<span class="token punctuation">.</span>SetGeoTransform<span class="token punctuation">(</span><span class="token punctuation">(</span>originX<span class="token punctuation">,</span> pixelWidth<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> originY<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pixelHeight<span class="token punctuation">)</span><span class="token punctuation">)</span>
    outband <span class="token operator">=</span> outRaster<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    outband<span class="token punctuation">.</span>WriteArray<span class="token punctuation">(</span>array<span class="token punctuation">)</span>
    outRasterSRS <span class="token operator">=</span> osr<span class="token punctuation">.</span>SpatialReference<span class="token punctuation">(</span><span class="token punctuation">)</span>
    outRasterSRS<span class="token punctuation">.</span>ImportFromEPSG<span class="token punctuation">(</span><span class="token number">4326</span><span class="token punctuation">)</span>
    outRaster<span class="token punctuation">.</span>SetProjection<span class="token punctuation">(</span>outRasterSRS<span class="token punctuation">.</span>ExportToWkt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    outband<span class="token punctuation">.</span>FlushCache<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>newRasterfn<span class="token punctuation">,</span>rasterOrigin<span class="token punctuation">,</span>pixelWidth<span class="token punctuation">,</span>pixelHeight<span class="token punctuation">,</span>array<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 反转数组</span>
    reversed_arr <span class="token operator">=</span> array<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
    <span class="token comment"># 数组转栅格</span>
    array2raster<span class="token punctuation">(</span>newRasterfn<span class="token punctuation">,</span>rasterOrigin<span class="token punctuation">,</span>pixelWidth<span class="token punctuation">,</span>pixelHeight<span class="token punctuation">,</span>reversed_arr<span class="token punctuation">)</span> 


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    rasterOrigin <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">123.25745</span><span class="token punctuation">,</span><span class="token number">45.43013</span><span class="token punctuation">)</span>
    pixelWidth <span class="token operator">=</span> <span class="token number">10</span>
    pixelHeight <span class="token operator">=</span> <span class="token number">10</span>
    newRasterfn <span class="token operator">=</span> <span class="token string">'test.tif'</span>
    array <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token punctuation">[</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>


    main<span class="token punctuation">(</span>newRasterfn<span class="token punctuation">,</span>rasterOrigin<span class="token punctuation">,</span>pixelWidth<span class="token punctuation">,</span>pixelHeight<span class="token punctuation">,</span>array<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="替换无效值"><a href="#替换无效值" class="headerlink" title="替换无效值"></a>替换无效值</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> gdal<span class="token punctuation">,</span> ogr<span class="token punctuation">,</span> osr<span class="token punctuation">,</span> os
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np

<span class="token keyword">def</span> <span class="token function">raster2array</span><span class="token punctuation">(</span>rasterfn<span class="token punctuation">)</span><span class="token punctuation">:</span>
    raster <span class="token operator">=</span> gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>rasterfn<span class="token punctuation">)</span>
    band <span class="token operator">=</span> raster<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> band<span class="token punctuation">.</span>ReadAsArray<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">getNoDataValue</span><span class="token punctuation">(</span>rasterfn<span class="token punctuation">)</span><span class="token punctuation">:</span>
    raster <span class="token operator">=</span> gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>rasterfn<span class="token punctuation">)</span>
    band <span class="token operator">=</span> raster<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> band<span class="token punctuation">.</span>GetNoDataValue<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">array2raster</span><span class="token punctuation">(</span>rasterfn<span class="token punctuation">,</span>newRasterfn<span class="token punctuation">,</span>array<span class="token punctuation">)</span><span class="token punctuation">:</span>
    raster <span class="token operator">=</span> gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>rasterfn<span class="token punctuation">)</span>
    geotransform <span class="token operator">=</span> raster<span class="token punctuation">.</span>GetGeoTransform<span class="token punctuation">(</span><span class="token punctuation">)</span>
    originX <span class="token operator">=</span> geotransform<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    originY <span class="token operator">=</span> geotransform<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
    pixelWidth <span class="token operator">=</span> geotransform<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    pixelHeight <span class="token operator">=</span> geotransform<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>
    cols <span class="token operator">=</span> raster<span class="token punctuation">.</span>RasterXSize
    rows <span class="token operator">=</span> raster<span class="token punctuation">.</span>RasterYSize

    driver <span class="token operator">=</span> gdal<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">'GTiff'</span><span class="token punctuation">)</span>
    outRaster <span class="token operator">=</span> driver<span class="token punctuation">.</span>Create<span class="token punctuation">(</span>newRasterfn<span class="token punctuation">,</span> cols<span class="token punctuation">,</span> rows<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> gdal<span class="token punctuation">.</span>GDT_Float32<span class="token punctuation">)</span>
    outRaster<span class="token punctuation">.</span>SetGeoTransform<span class="token punctuation">(</span><span class="token punctuation">(</span>originX<span class="token punctuation">,</span> pixelWidth<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> originY<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> pixelHeight<span class="token punctuation">)</span><span class="token punctuation">)</span>
    outband <span class="token operator">=</span> outRaster<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    outband<span class="token punctuation">.</span>WriteArray<span class="token punctuation">(</span>array<span class="token punctuation">)</span>
    outRasterSRS <span class="token operator">=</span> osr<span class="token punctuation">.</span>SpatialReference<span class="token punctuation">(</span><span class="token punctuation">)</span>
    outRasterSRS<span class="token punctuation">.</span>ImportFromWkt<span class="token punctuation">(</span>raster<span class="token punctuation">.</span>GetProjectionRef<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    outRaster<span class="token punctuation">.</span>SetProjection<span class="token punctuation">(</span>outRasterSRS<span class="token punctuation">.</span>ExportToWkt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    outband<span class="token punctuation">.</span>FlushCache<span class="token punctuation">(</span><span class="token punctuation">)</span>


rasterfn <span class="token operator">=</span> <span class="token string">'test.tif'</span>
newValue <span class="token operator">=</span> <span class="token number">0</span>
newRasterfn <span class="token operator">=</span> <span class="token string">'testNew.tif'</span>

<span class="token comment"># 栅格转数组</span>
rasterArray <span class="token operator">=</span> raster2array<span class="token punctuation">(</span>rasterfn<span class="token punctuation">)</span>

<span class="token comment"># 获取无效值</span>
noDataValue <span class="token operator">=</span> getNoDataValue<span class="token punctuation">(</span>rasterfn<span class="token punctuation">)</span>

<span class="token comment"># 更新无效值</span>
rasterArray<span class="token punctuation">[</span>rasterArray <span class="token operator">==</span> noDataValue<span class="token punctuation">]</span> <span class="token operator">=</span> newValue

<span class="token comment"># 数组转栅格</span>
array2raster<span class="token punctuation">(</span>rasterfn<span class="token punctuation">,</span>newRasterfn<span class="token punctuation">,</span>rasterArray<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="投影"><a href="#投影" class="headerlink" title="投影"></a>投影</h1><h2 id="创建投影"><a href="#创建投影" class="headerlink" title="创建投影"></a>创建投影</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> osr
spatialRef <span class="token operator">=</span> osr<span class="token punctuation">.</span>SpatialReference<span class="token punctuation">(</span><span class="token punctuation">)</span>
spatialRef<span class="token punctuation">.</span>ImportFromEPSG<span class="token punctuation">(</span><span class="token number">4326</span><span class="token punctuation">)</span> <span class="token comment">#WGS84</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h2 id="重投影"><a href="#重投影" class="headerlink" title="重投影"></a>重投影</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr
<span class="token keyword">from</span> osgeo <span class="token keyword">import</span> osr

source <span class="token operator">=</span> osr<span class="token punctuation">.</span>SpatialReference<span class="token punctuation">(</span><span class="token punctuation">)</span>
source<span class="token punctuation">.</span>ImportFromEPSG<span class="token punctuation">(</span><span class="token number">2927</span><span class="token punctuation">)</span>

target <span class="token operator">=</span> osr<span class="token punctuation">.</span>SpatialReference<span class="token punctuation">(</span><span class="token punctuation">)</span>
target<span class="token punctuation">.</span>ImportFromEPSG<span class="token punctuation">(</span><span class="token number">4326</span><span class="token punctuation">)</span>

transform <span class="token operator">=</span> osr<span class="token punctuation">.</span>CoordinateTransformation<span class="token punctuation">(</span>source<span class="token punctuation">,</span> target<span class="token punctuation">)</span>

point <span class="token operator">=</span> ogr<span class="token punctuation">.</span>CreateGeometryFromWkt<span class="token punctuation">(</span><span class="token string">"POINT (1120351.57 741921.42)"</span><span class="token punctuation">)</span>
point<span class="token punctuation">.</span>Transform<span class="token punctuation">(</span>transform<span class="token punctuation">)</span>

<span class="token keyword">print</span> <span class="token punctuation">(</span>point<span class="token punctuation">.</span>ExportToWkt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="获取投影"><a href="#获取投影" class="headerlink" title="获取投影"></a>获取投影</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr<span class="token punctuation">,</span> osr
driver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">'ESRI Shapefile'</span><span class="token punctuation">)</span>
dataset <span class="token operator">=</span> driver<span class="token punctuation">.</span>Open<span class="token punctuation">(</span><span class="token string">r'./data/test.shp'</span><span class="token punctuation">)</span>

<span class="token comment"># 图层</span>
layer <span class="token operator">=</span> dataset<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>
spatialRef <span class="token operator">=</span> layer<span class="token punctuation">.</span>GetSpatialRef<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 几何</span>
feature <span class="token operator">=</span> layer<span class="token punctuation">.</span>GetNextFeature<span class="token punctuation">(</span><span class="token punctuation">)</span>
geom <span class="token operator">=</span> feature<span class="token punctuation">.</span>GetGeometryRef<span class="token punctuation">(</span><span class="token punctuation">)</span>
spatialRef <span class="token operator">=</span> geom<span class="token punctuation">.</span>GetSpatialReference<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="重投影图层"><a href="#重投影图层" class="headerlink" title="重投影图层"></a>重投影图层</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr<span class="token punctuation">,</span> osr
<span class="token keyword">import</span> os

driver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">'ESRI Shapefile'</span><span class="token punctuation">)</span>

<span class="token comment"># 输入空间参考</span>
inSpatialRef <span class="token operator">=</span> osr<span class="token punctuation">.</span>SpatialReference<span class="token punctuation">(</span><span class="token punctuation">)</span>
inSpatialRef<span class="token punctuation">.</span>ImportFromEPSG<span class="token punctuation">(</span><span class="token number">2927</span><span class="token punctuation">)</span>

<span class="token comment"># 输出空间参考</span>
outSpatialRef <span class="token operator">=</span> osr<span class="token punctuation">.</span>SpatialReference<span class="token punctuation">(</span><span class="token punctuation">)</span>
outSpatialRef<span class="token punctuation">.</span>ImportFromEPSG<span class="token punctuation">(</span><span class="token number">4326</span><span class="token punctuation">)</span>

<span class="token comment"># 创建坐标转换</span>
coordTrans <span class="token operator">=</span> osr<span class="token punctuation">.</span>CoordinateTransformation<span class="token punctuation">(</span>inSpatialRef<span class="token punctuation">,</span> outSpatialRef<span class="token punctuation">)</span>

<span class="token comment"># 输入图层</span>
inDataSet <span class="token operator">=</span> driver<span class="token punctuation">.</span>Open<span class="token punctuation">(</span><span class="token string">r'./data/test.shp'</span><span class="token punctuation">)</span>
inLayer <span class="token operator">=</span> inDataSet<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 创建输出图层</span>
outputShapefile <span class="token operator">=</span> <span class="token string">r'./data/test_4326.shp'</span>
<span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>outputShapefile<span class="token punctuation">)</span><span class="token punctuation">:</span>
    driver<span class="token punctuation">.</span>DeleteDataSource<span class="token punctuation">(</span>outputShapefile<span class="token punctuation">)</span>
outDataSet <span class="token operator">=</span> driver<span class="token punctuation">.</span>CreateDataSource<span class="token punctuation">(</span>outputShapefile<span class="token punctuation">)</span>
outLayer <span class="token operator">=</span> outDataSet<span class="token punctuation">.</span>CreateLayer<span class="token punctuation">(</span>
    <span class="token string">"test_4326"</span><span class="token punctuation">,</span> 
    geom_type<span class="token operator">=</span>ogr<span class="token punctuation">.</span>wkbMultiPolygon<span class="token punctuation">,</span>
    srs<span class="token operator">=</span>outSpatialRef <span class="token comment"># 输出prj文件</span>
<span class="token punctuation">)</span>

<span class="token comment"># 添加字段</span>
inLayerDefn <span class="token operator">=</span> inLayer<span class="token punctuation">.</span>GetLayerDefn<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> inLayerDefn<span class="token punctuation">.</span>GetFieldCount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    fieldDefn <span class="token operator">=</span> inLayerDefn<span class="token punctuation">.</span>GetFieldDefn<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    outLayer<span class="token punctuation">.</span>CreateField<span class="token punctuation">(</span>fieldDefn<span class="token punctuation">)</span>

outLayerDefn <span class="token operator">=</span> outLayer<span class="token punctuation">.</span>GetLayerDefn<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 遍历要素</span>
inFeature <span class="token operator">=</span> inLayer<span class="token punctuation">.</span>GetNextFeature<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">while</span> inFeature<span class="token punctuation">:</span>
    <span class="token comment"># 获取几何</span>
    geom <span class="token operator">=</span> inFeature<span class="token punctuation">.</span>GetGeometryRef<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 重投影几何</span>
    geom<span class="token punctuation">.</span>Transform<span class="token punctuation">(</span>coordTrans<span class="token punctuation">)</span>
    <span class="token comment"># 创建要素</span>
    outFeature <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Feature<span class="token punctuation">(</span>outLayerDefn<span class="token punctuation">)</span>
    <span class="token comment"># 设置几何、属性</span>
    outFeature<span class="token punctuation">.</span>SetGeometry<span class="token punctuation">(</span>geom<span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> outLayerDefn<span class="token punctuation">.</span>GetFieldCount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        outFeature<span class="token punctuation">.</span>SetField<span class="token punctuation">(</span>outLayerDefn<span class="token punctuation">.</span>GetFieldDefn<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>GetNameRef<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> inFeature<span class="token punctuation">.</span>GetField<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 添加要素</span>
    outLayer<span class="token punctuation">.</span>CreateFeature<span class="token punctuation">(</span>outFeature<span class="token punctuation">)</span>
    <span class="token comment"># 取消引用</span>
    outFeature <span class="token operator">=</span> <span class="token boolean">None</span>
    inFeature <span class="token operator">=</span> inLayer<span class="token punctuation">.</span>GetNextFeature<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 保存并关闭</span>
inDataSet <span class="token operator">=</span> <span class="token boolean">None</span>
outDataSet <span class="token operator">=</span> <span class="token boolean">None</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="输出投影"><a href="#输出投影" class="headerlink" title="输出投影"></a>输出投影</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr<span class="token punctuation">,</span> osr
driver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">'ESRI Shapefile'</span><span class="token punctuation">)</span>
dataset <span class="token operator">=</span> driver<span class="token punctuation">.</span>Open<span class="token punctuation">(</span><span class="token string">r'./data/test_4326.shp'</span><span class="token punctuation">)</span>
layer <span class="token operator">=</span> dataset<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>
spatialRef <span class="token operator">=</span> layer<span class="token punctuation">.</span>GetSpatialRef<span class="token punctuation">(</span><span class="token punctuation">)</span>

spatialRef<span class="token punctuation">.</span>ExportToWkt<span class="token punctuation">(</span><span class="token punctuation">)</span>
spatialRef<span class="token punctuation">.</span>ExportToPrettyWkt<span class="token punctuation">(</span><span class="token punctuation">)</span>
spatialRef<span class="token punctuation">.</span>ExportToPCI<span class="token punctuation">(</span><span class="token punctuation">)</span>
spatialRef<span class="token punctuation">.</span>ExportToUSGS<span class="token punctuation">(</span><span class="token punctuation">)</span>
spatialRef<span class="token punctuation">.</span>ExportToXML<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="创建ESRI投影文件"><a href="#创建ESRI投影文件" class="headerlink" title="创建ESRI投影文件"></a>创建ESRI投影文件</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr<span class="token punctuation">,</span> osr

spatialRef <span class="token operator">=</span> osr<span class="token punctuation">.</span>SpatialReference<span class="token punctuation">(</span><span class="token punctuation">)</span>
spatialRef<span class="token punctuation">.</span>ImportFromEPSG<span class="token punctuation">(</span><span class="token number">26912</span><span class="token punctuation">)</span>

spatialRef<span class="token punctuation">.</span>MorphToESRI<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'yourshpfile.prj'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
<span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>spatialRef<span class="token punctuation">.</span>ExportToWkt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token builtin">file</span><span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="创建质心"><a href="#创建质心" class="headerlink" title="创建质心"></a>创建质心</h1><p>centroidTopLeft = quaterPolyTopLeft.Centroid()<br>centroidTopRight =  quaterPolyTopRight.Centroid()<br>centroidBottomLeft =  quaterPolyBottomLeft.Centroid()<br>centroidBottomRight =  quaterPolyBottomRight.Centroid()</p>
<h1 id="矢量图层"><a href="#矢量图层" class="headerlink" title="矢量图层"></a>矢量图层</h1><h2 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr
<span class="token keyword">import</span> os

DriverName <span class="token operator">=</span> <span class="token string">"ESRI Shapefile"</span>      <span class="token comment"># e.g.: GeoJSON, ESRI Shapefile</span>
FileName <span class="token operator">=</span> <span class="token string">'test.shp'</span>
driver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span>DriverName<span class="token punctuation">)</span>
<span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>FileName<span class="token punctuation">)</span><span class="token punctuation">:</span>
     driver<span class="token punctuation">.</span>DeleteDataSource<span class="token punctuation">(</span>FileName<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="获取OGR驱动列表"><a href="#获取OGR驱动列表" class="headerlink" title="获取OGR驱动列表"></a>获取OGR驱动列表</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> ogr
cnt <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverCount<span class="token punctuation">(</span><span class="token punctuation">)</span>
formatsList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># Empty List</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>cnt<span class="token punctuation">)</span><span class="token punctuation">:</span>
    driver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriver<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    driverName <span class="token operator">=</span> driver<span class="token punctuation">.</span>GetName<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> driverName <span class="token keyword">in</span> formatsList<span class="token punctuation">:</span>
        formatsList<span class="token punctuation">.</span>append<span class="token punctuation">(</span>driverName<span class="token punctuation">)</span>

formatsList<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 排序</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>formatsList<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="驱动是否可用"><a href="#驱动是否可用" class="headerlink" title="驱动是否可用"></a>驱动是否可用</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr

<span class="token comment">## Shapefile 是否可用?</span>
driverName <span class="token operator">=</span> <span class="token string">"ESRI Shapefile"</span>
drv <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span> driverName <span class="token punctuation">)</span>
<span class="token keyword">if</span> drv <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"%s 驱动不可用.\n"</span> <span class="token operator">%</span> driverName<span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span>  <span class="token punctuation">(</span><span class="token string">"%s 驱动可用.\n"</span> <span class="token operator">%</span> driverName<span class="token punctuation">)</span>

<span class="token comment">## PostgreSQL 是否可用?</span>
driverName <span class="token operator">=</span> <span class="token string">"PostgreSQL"</span>
drv <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span> driverName <span class="token punctuation">)</span>
<span class="token keyword">if</span> drv <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"%s 驱动不可用.\n"</span> <span class="token operator">%</span> driverName<span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span>  <span class="token punctuation">(</span><span class="token string">"%s 驱动可用.\n"</span> <span class="token operator">%</span> driverName<span class="token punctuation">)</span>

<span class="token comment">## File GeoDatabase 是否可用?</span>
driverName <span class="token operator">=</span> <span class="token string">"FileGDB"</span>
drv <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span> driverName <span class="token punctuation">)</span>
<span class="token keyword">if</span> drv <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"%s 驱动不可用.\n"</span> <span class="token operator">%</span> driverName<span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span>  <span class="token punctuation">(</span><span class="token string">"%s 驱动可用.\n"</span> <span class="token operator">%</span> driverName<span class="token punctuation">)</span>

<span class="token comment">## SDE 是否可用?</span>
driverName <span class="token operator">=</span> <span class="token string">"SDE"</span>
drv <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span> driverName <span class="token punctuation">)</span>
<span class="token keyword">if</span> drv <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"%s 驱动不可用.\n"</span> <span class="token operator">%</span> driverName<span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span>  <span class="token punctuation">(</span><span class="token string">"%s 驱动可用.\n"</span> <span class="token operator">%</span> driverName<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="获取shapefile要素个数"><a href="#获取shapefile要素个数" class="headerlink" title="获取shapefile要素个数"></a>获取shapefile要素个数</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os
<span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr

daShapefile <span class="token operator">=</span> <span class="token string">r"/test.shp"</span>

driver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">'ESRI Shapefile'</span><span class="token punctuation">)</span>

dataSource <span class="token operator">=</span> driver<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>daShapefile<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment"># 0 只读. 1 读写.</span>

<span class="token comment"># 检查数据源是否有效.</span>
<span class="token keyword">if</span> dataSource <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'不能打开 %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>daShapefile<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'打开 %s'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>daShapefile<span class="token punctuation">)</span><span class="token punctuation">)</span>
    layer <span class="token operator">=</span> dataSource<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>
    featureCount <span class="token operator">=</span> layer<span class="token punctuation">.</span>GetFeatureCount<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"%s 要素个数: %d"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>basename<span class="token punctuation">(</span>daShapefile<span class="token punctuation">)</span><span class="token punctuation">,</span>featureCount<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="获取PostGIS图层"><a href="#获取PostGIS图层" class="headerlink" title="获取PostGIS图层"></a>获取PostGIS图层</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr

databaseServer <span class="token operator">=</span> <span class="token string">"localhost"</span>
databaseName <span class="token operator">=</span> <span class="token string">"test2020"</span>
databaseUser <span class="token operator">=</span> <span class="token string">"postgres"</span>
databasePW <span class="token operator">=</span> <span class="token string">"123456"</span>


connString <span class="token operator">=</span> <span class="token string">"PG: host=%s dbname=%s user=%s password=%s"</span> <span class="token operator">%</span><span class="token punctuation">(</span>databaseServer<span class="token punctuation">,</span>databaseName<span class="token punctuation">,</span>databaseUser<span class="token punctuation">,</span>databasePW<span class="token punctuation">)</span>

conn <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>connString<span class="token punctuation">)</span>

layerList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> conn<span class="token punctuation">:</span>
    daLayer <span class="token operator">=</span> i<span class="token punctuation">.</span>GetName<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> daLayer <span class="token keyword">in</span> layerList<span class="token punctuation">:</span>
        layerList<span class="token punctuation">.</span>append<span class="token punctuation">(</span>daLayer<span class="token punctuation">)</span>

layerList<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> j <span class="token keyword">in</span> layerList<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>
    
<span class="token comment"># 关闭连接</span>
conn <span class="token operator">=</span> <span class="token boolean">None</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="获取PostGIS图层的要素"><a href="#获取PostGIS图层的要素" class="headerlink" title="获取PostGIS图层的要素"></a>获取PostGIS图层的要素</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr
<span class="token keyword">import</span> sys

databaseServer <span class="token operator">=</span> <span class="token string">"localhost"</span>
databaseName <span class="token operator">=</span> <span class="token string">"test2020"</span>
databaseUser <span class="token operator">=</span> <span class="token string">"postgres"</span>
databasePW <span class="token operator">=</span> <span class="token string">"123456"</span>
connString <span class="token operator">=</span> <span class="token string">"PG: host=%s dbname=%s user=%s password=%s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>databaseServer<span class="token punctuation">,</span>databaseName<span class="token punctuation">,</span>databaseUser<span class="token punctuation">,</span>databasePW<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">GetPGLayer</span><span class="token punctuation">(</span> lyr_name <span class="token punctuation">)</span><span class="token punctuation">:</span>
    conn <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>connString<span class="token punctuation">)</span>

    lyr <span class="token operator">=</span> conn<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span> lyr_name <span class="token punctuation">)</span>
    <span class="token keyword">if</span> lyr <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span>

    featureCount <span class="token operator">=</span> lyr<span class="token punctuation">.</span>GetFeatureCount<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"%s 要素个数 : %d"</span> <span class="token operator">%</span> <span class="token punctuation">(</span> lyr_name <span class="token punctuation">,</span> featureCount <span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 关闭连接</span>
    conn <span class="token operator">=</span> <span class="token boolean">None</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    GetPGLayer<span class="token punctuation">(</span> <span class="token string">"test"</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="获取ESRI-GDB图层"><a href="#获取ESRI-GDB图层" class="headerlink" title="获取ESRI GDB图层"></a>获取ESRI GDB图层</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys
<span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr

ogr<span class="token punctuation">.</span>UseExceptions<span class="token punctuation">(</span><span class="token punctuation">)</span>

driver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">"OpenFileGDB"</span><span class="token punctuation">)</span>

<span class="token comment"># opening the FileGDB</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    gdb <span class="token operator">=</span> driver<span class="token punctuation">.</span>Open<span class="token punctuation">(</span><span class="token string">"/sparse.gdb"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>

featsClassList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment"># 获取图层</span>
<span class="token keyword">for</span> featsClass_idx <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>gdb<span class="token punctuation">.</span>GetLayerCount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    featsClass <span class="token operator">=</span> gdb<span class="token punctuation">.</span>GetLayerByIndex<span class="token punctuation">(</span>featsClass_idx<span class="token punctuation">)</span>
    featsClassList<span class="token punctuation">.</span>append<span class="token punctuation">(</span>featsClass<span class="token punctuation">.</span>GetName<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

featsClassList<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> featsClass <span class="token keyword">in</span> featsClassList<span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span>featsClass<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="加载数据到内存"><a href="#加载数据到内存" class="headerlink" title="加载数据到内存"></a>加载数据到内存</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr

<span class="token comment"># 打开输入数据源</span>
indriver<span class="token operator">=</span>ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">'SQLite'</span><span class="token punctuation">)</span>
srcdb <span class="token operator">=</span> indriver<span class="token punctuation">.</span>Open<span class="token punctuation">(</span><span class="token string">'/poly_spatialite.sqlite'</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>

<span class="token comment"># 创建内存输出数据源</span>
outdriver<span class="token operator">=</span>ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">'MEMORY'</span><span class="token punctuation">)</span>
source<span class="token operator">=</span>outdriver<span class="token punctuation">.</span>CreateDataSource<span class="token punctuation">(</span><span class="token string">'memData'</span><span class="token punctuation">)</span>

<span class="token comment"># 打开内存数据</span>
tmp<span class="token operator">=</span>outdriver<span class="token punctuation">.</span>Open<span class="token punctuation">(</span><span class="token string">'memData'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># 复制图层到内存</span>
poly_mem<span class="token operator">=</span>source<span class="token punctuation">.</span>CopyLayer<span class="token punctuation">(</span>srcdb<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token string">'poly'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">'poly'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token string">'OVERWRITE=YES'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 新的图层可直接被访问，poly_mem 或者 source.GetLayer('poly'):</span>
layer<span class="token operator">=</span>source<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token string">'poly'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> feature <span class="token keyword">in</span> layer<span class="token punctuation">:</span>
    feature<span class="token punctuation">.</span>SetField<span class="token punctuation">(</span><span class="token string">'area'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="遍历要素"><a href="#遍历要素" class="headerlink" title="遍历要素"></a>遍历要素</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr
<span class="token keyword">import</span> os

shapefile <span class="token operator">=</span> <span class="token string">"/test.shp"</span>
driver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">"ESRI Shapefile"</span><span class="token punctuation">)</span>
dataSource <span class="token operator">=</span> driver<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>shapefile<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
layer <span class="token operator">=</span> dataSource<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> feature <span class="token keyword">in</span> layer<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span> feature<span class="token punctuation">.</span>GetField<span class="token punctuation">(</span><span class="token string">"area"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
layer<span class="token punctuation">.</span>ResetReading<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="遍历要素几何"><a href="#遍历要素几何" class="headerlink" title="遍历要素几何"></a>遍历要素几何</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr
<span class="token keyword">import</span> os

shapefile <span class="token operator">=</span> <span class="token string">"/test.shp"</span>
driver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">"ESRI Shapefile"</span><span class="token punctuation">)</span>
dataSource <span class="token operator">=</span> driver<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>shapefile<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
layer <span class="token operator">=</span> dataSource<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> feature <span class="token keyword">in</span> layer<span class="token punctuation">:</span>
    geom <span class="token operator">=</span> feature<span class="token punctuation">.</span>GetGeometryRef<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># 获取质心</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span>geom<span class="token punctuation">.</span>Centroid<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>ExportToWkt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="过滤属性"><a href="#过滤属性" class="headerlink" title="过滤属性"></a>过滤属性</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr
<span class="token keyword">import</span> os

shapefile <span class="token operator">=</span> <span class="token string">"/test.shp"</span>
driver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">"ESRI Shapefile"</span><span class="token punctuation">)</span>
dataSource <span class="token operator">=</span> driver<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>shapefile<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
layer <span class="token operator">=</span> dataSource<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>

layer<span class="token punctuation">.</span>SetAttributeFilter<span class="token punctuation">(</span><span class="token string">"area = 5268.813"</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> feature <span class="token keyword">in</span> layer<span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span>feature<span class="token punctuation">.</span>GetField<span class="token punctuation">(</span><span class="token string">"area"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="空间过滤"><a href="#空间过滤" class="headerlink" title="空间过滤"></a>空间过滤</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr
<span class="token keyword">import</span> os

shapefile <span class="token operator">=</span> <span class="token string">"/test.shp"</span>
driver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">"ESRI Shapefile"</span><span class="token punctuation">)</span>
dataSource <span class="token operator">=</span> driver<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>shapefile<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
layer <span class="token operator">=</span> dataSource<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>

wkt <span class="token operator">=</span> <span class="token string">"POLYGON ((479386 4764749,481098 4764226,480772 4763114,478681 4763159,479386 4764749))"</span>
layer<span class="token punctuation">.</span>SetSpatialFilter<span class="token punctuation">(</span>ogr<span class="token punctuation">.</span>CreateGeometryFromWkt<span class="token punctuation">(</span>wkt<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> feature <span class="token keyword">in</span> layer<span class="token punctuation">:</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span>feature<span class="token punctuation">.</span>GetField<span class="token punctuation">(</span><span class="token string">"area"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="获取要素字段"><a href="#获取要素字段" class="headerlink" title="获取要素字段"></a>获取要素字段</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr

daShapefile <span class="token operator">=</span> <span class="token string">r"/test.shp"</span>

dataSource <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>daShapefile<span class="token punctuation">)</span>
daLayer <span class="token operator">=</span> dataSource<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
layerDefinition <span class="token operator">=</span> daLayer<span class="token punctuation">.</span>GetLayerDefn<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>layerDefinition<span class="token punctuation">.</span>GetFieldCount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    fieldName <span class="token operator">=</span>  layerDefinition<span class="token punctuation">.</span>GetFieldDefn<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>GetName<span class="token punctuation">(</span><span class="token punctuation">)</span>
    fieldTypeCode <span class="token operator">=</span> layerDefinition<span class="token punctuation">.</span>GetFieldDefn<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>GetType<span class="token punctuation">(</span><span class="token punctuation">)</span>
    fieldType <span class="token operator">=</span> layerDefinition<span class="token punctuation">.</span>GetFieldDefn<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>GetFieldTypeName<span class="token punctuation">(</span>fieldTypeCode<span class="token punctuation">)</span>
    fieldWidth <span class="token operator">=</span> layerDefinition<span class="token punctuation">.</span>GetFieldDefn<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>GetWidth<span class="token punctuation">(</span><span class="token punctuation">)</span>
    GetPrecision <span class="token operator">=</span> layerDefinition<span class="token punctuation">.</span>GetFieldDefn<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>GetPrecision<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">print</span> <span class="token punctuation">(</span>fieldName <span class="token operator">+</span> <span class="token string">" - "</span> <span class="token operator">+</span> fieldType<span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>fieldWidth<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>GetPrecision<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="获取PostGIS图层字段"><a href="#获取PostGIS图层字段" class="headerlink" title="获取PostGIS图层字段"></a>获取PostGIS图层字段</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr
<span class="token keyword">import</span> sys

databaseServer <span class="token operator">=</span> <span class="token string">"localhost"</span>
databaseName <span class="token operator">=</span> <span class="token string">"test2020"</span>
databaseUser <span class="token operator">=</span> <span class="token string">"postgres"</span>
databasePW <span class="token operator">=</span> <span class="token string">"123456"</span>
connString <span class="token operator">=</span> <span class="token string">"PG: host=%s dbname=%s user=%s password=%s"</span> <span class="token operator">%</span><span class="token punctuation">(</span>databaseServer<span class="token punctuation">,</span>databaseName<span class="token punctuation">,</span>databaseUser<span class="token punctuation">,</span>databasePW<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">GetPGLayerFields</span><span class="token punctuation">(</span> lyr_name <span class="token punctuation">)</span><span class="token punctuation">:</span>
    conn <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>connString<span class="token punctuation">)</span>

    lyr <span class="token operator">=</span> conn<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span> lyr_name <span class="token punctuation">)</span>
    <span class="token keyword">if</span> lyr <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span>

    lyrDefn <span class="token operator">=</span> lyr<span class="token punctuation">.</span>GetLayerDefn<span class="token punctuation">(</span><span class="token punctuation">)</span>


    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span> lyrDefn<span class="token punctuation">.</span>GetFieldCount<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">:</span>
        fieldName <span class="token operator">=</span>  lyrDefn<span class="token punctuation">.</span>GetFieldDefn<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>GetName<span class="token punctuation">(</span><span class="token punctuation">)</span>
        fieldTypeCode <span class="token operator">=</span> lyrDefn<span class="token punctuation">.</span>GetFieldDefn<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>GetType<span class="token punctuation">(</span><span class="token punctuation">)</span>
        fieldType <span class="token operator">=</span> lyrDefn<span class="token punctuation">.</span>GetFieldDefn<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>GetFieldTypeName<span class="token punctuation">(</span>fieldTypeCode<span class="token punctuation">)</span>
        fieldWidth <span class="token operator">=</span> lyrDefn<span class="token punctuation">.</span>GetFieldDefn<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>GetWidth<span class="token punctuation">(</span><span class="token punctuation">)</span>
        GetPrecision <span class="token operator">=</span> lyrDefn<span class="token punctuation">.</span>GetFieldDefn<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>GetPrecision<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token keyword">print</span> <span class="token punctuation">(</span>fieldName <span class="token operator">+</span> <span class="token string">" - "</span> <span class="token operator">+</span> fieldType<span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>fieldWidth<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">" "</span> <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>GetPrecision<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    GetPGLayerFields<span class="token punctuation">(</span> <span class="token string">"test"</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="获取图层能力"><a href="#获取图层能力" class="headerlink" title="获取图层能力"></a>获取图层能力</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr

ds <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Open<span class="token punctuation">(</span><span class="token string">"/test.shp"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
layer <span class="token operator">=</span> ds<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>
capabilities <span class="token operator">=</span> <span class="token punctuation">[</span>
    ogr<span class="token punctuation">.</span>OLCRandomRead<span class="token punctuation">,</span>
    ogr<span class="token punctuation">.</span>OLCSequentialWrite<span class="token punctuation">,</span>
    ogr<span class="token punctuation">.</span>OLCRandomWrite<span class="token punctuation">,</span>
    ogr<span class="token punctuation">.</span>OLCFastSpatialFilter<span class="token punctuation">,</span>
    ogr<span class="token punctuation">.</span>OLCFastFeatureCount<span class="token punctuation">,</span>
    ogr<span class="token punctuation">.</span>OLCFastGetExtent<span class="token punctuation">,</span>
    ogr<span class="token punctuation">.</span>OLCCreateField<span class="token punctuation">,</span>
    ogr<span class="token punctuation">.</span>OLCDeleteField<span class="token punctuation">,</span>
    ogr<span class="token punctuation">.</span>OLCReorderFields<span class="token punctuation">,</span>
    ogr<span class="token punctuation">.</span>OLCAlterFieldDefn<span class="token punctuation">,</span>
    ogr<span class="token punctuation">.</span>OLCTransactions<span class="token punctuation">,</span>
    ogr<span class="token punctuation">.</span>OLCDeleteFeature<span class="token punctuation">,</span>
    ogr<span class="token punctuation">.</span>OLCFastSetNextByIndex<span class="token punctuation">,</span>
    ogr<span class="token punctuation">.</span>OLCStringsAsUTF8<span class="token punctuation">,</span>
    ogr<span class="token punctuation">.</span>OLCIgnoreFields
<span class="token punctuation">]</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"图层能力:"</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> cap <span class="token keyword">in</span> capabilities<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"  %s = %s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>cap<span class="token punctuation">,</span> layer<span class="token punctuation">.</span>TestCapability<span class="token punctuation">(</span>cap<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="WFS图层和遍历要素"><a href="#WFS图层和遍历要素" class="headerlink" title="WFS图层和遍历要素"></a>WFS图层和遍历要素</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys

<span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr<span class="token punctuation">,</span> osr<span class="token punctuation">,</span> gdal

<span class="token comment"># 获取WFS驱动</span>
wfs_drv <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">'WFS'</span><span class="token punctuation">)</span>

<span class="token comment"># 加快查询多图层WFS服务</span>
gdal<span class="token punctuation">.</span>SetConfigOption<span class="token punctuation">(</span><span class="token string">'OGR_WFS_LOAD_MULTIPLE_LAYER_DEFN'</span><span class="token punctuation">,</span> <span class="token string">'NO'</span><span class="token punctuation">)</span>

<span class="token comment"># 设置分页的配置。适用于WFS 2.0服务以及WFS 1.0和1.1以及其他一些服务。</span>
gdal<span class="token punctuation">.</span>SetConfigOption<span class="token punctuation">(</span><span class="token string">'OGR_WFS_PAGING_ALLOWED'</span><span class="token punctuation">,</span> <span class="token string">'YES'</span><span class="token punctuation">)</span>
gdal<span class="token punctuation">.</span>SetConfigOption<span class="token punctuation">(</span><span class="token string">'OGR_WFS_PAGE_SIZE'</span><span class="token punctuation">,</span> <span class="token string">'10000'</span><span class="token punctuation">)</span>

url <span class="token operator">=</span> <span class="token string">'http://sampleserver6.arcgisonline.com/arcgis/services/SampleWorldCities/MapServer/WFSServer'</span>
wfs_ds <span class="token operator">=</span> wfs_drv<span class="token punctuation">.</span>Open<span class="token punctuation">(</span><span class="token string">'WFS:'</span> <span class="token operator">+</span> url<span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> wfs_ds<span class="token punctuation">:</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token string">'错误: 不能打开 WFS 数据源'</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token comment"># 遍历图层</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>wfs_ds<span class="token punctuation">.</span>GetLayerCount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    layer <span class="token operator">=</span> wfs_ds<span class="token punctuation">.</span>GetLayerByIndex<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    srs <span class="token operator">=</span> layer<span class="token punctuation">.</span>GetSpatialRef<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">'Layer: %s, Features: %s, SR: %s...'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>layer<span class="token punctuation">.</span>GetName<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> layer<span class="token punctuation">.</span>GetFeatureCount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> srs<span class="token punctuation">.</span>ExportToWkt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># 遍历要素</span>
    feat <span class="token operator">=</span> layer<span class="token punctuation">.</span>GetNextFeature<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">while</span> feat <span class="token keyword">is</span> <span class="token keyword">not</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        feat <span class="token operator">=</span> layer<span class="token punctuation">.</span>GetNextFeature<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># do something more..</span>
    feat <span class="token operator">=</span> <span class="token boolean">None</span>

<span class="token comment"># 获取指定图层</span>
layer <span class="token operator">=</span> wfs_ds<span class="token punctuation">.</span>GetLayerByName<span class="token punctuation">(</span><span class="token string">"esri:World"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> layer<span class="token punctuation">:</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token string">'错误：不能找到图层：esri:World'</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="设置HTTP代理"><a href="#设置HTTP代理" class="headerlink" title="设置HTTP代理"></a>设置HTTP代理</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys

<span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr<span class="token punctuation">,</span> osr<span class="token punctuation">,</span> gdal

server <span class="token operator">=</span> <span class="token string">'proxy.example.com'</span>
port <span class="token operator">=</span> <span class="token number">3128</span>

<span class="token comment"># 设置代理</span>
gdal<span class="token punctuation">.</span>SetConfigOption<span class="token punctuation">(</span><span class="token string">'GDAL_HTTP_PROXY'</span><span class="token punctuation">,</span> server <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> port<span class="token punctuation">)</span>

<span class="token comment"># 没有用户名或密码的NTLM设置代理身份验证选项，因此单点登录有效</span>
gdal<span class="token punctuation">.</span>SetConfigOption<span class="token punctuation">(</span><span class="token string">'GDAL_PROXY_AUTH'</span><span class="token punctuation">,</span> <span class="token string">'NTLM'</span><span class="token punctuation">)</span>
gdal<span class="token punctuation">.</span>SetConfigOption<span class="token punctuation">(</span><span class="token string">'GDAL_HTTP_PROXYUSERPWD'</span><span class="token punctuation">,</span> <span class="token string">' : '</span><span class="token punctuation">)</span>

ds <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Open<span class="token punctuation">(</span><span class="token string">'http://featureserver/cities/.geojson'</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token keyword">not</span> ds<span class="token punctuation">:</span>
    sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token string">'ERROR: can not open GeoJSON datasource'</span><span class="token punctuation">)</span>
lyr <span class="token operator">=</span> ds<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token string">'OGRGeoJSON'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> feat <span class="token keyword">in</span> lyr<span class="token punctuation">:</span>
    geom <span class="token operator">=</span> feat<span class="token punctuation">.</span>GetGeometryRef<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span> geom<span class="token punctuation">.</span>ExportToWkt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="读取CSV经纬度作为OGRVRTLayer"><a href="#读取CSV经纬度作为OGRVRTLayer" class="headerlink" title="读取CSV经纬度作为OGRVRTLayer"></a>读取CSV经纬度作为OGRVRTLayer</h2><p>GDAL/OGR具有<a target="_blank" rel="noopener" href="https://gdal.org/drivers/vector/vrt.html">虚拟格式规范</a>，该规范允许你从诸如CSV之类的平面表派生图层——它的功能远不止于此，因此请继续阅读。在下面的示例中，我们正在读取带有X、Y列和值的CSV。该CSV文件由XML文件包装，该XML文件将其描述为OGR层。以下是所有必要的部分和一个脚本，该脚本读取XML文件并打印出点的几何形状。</p>
<p>CSV文件：</p>
<pre class="line-numbers language-none"><code class="language-none">ID,X,Y
1,-127.234343,47.234325
2,-127.003243,46.234343
3,-127.345646,45.234324
4,-126.234324,44.324234<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>XML文件</p>
<pre class="line-numbers language-xml" data-language="xml"><code class="language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>OGRVRTDataSource</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>OGRVRTLayer</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>example<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SrcDataSource</span><span class="token punctuation">&gt;</span></span>example.csv<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SrcDataSource</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>SrcLayer</span><span class="token punctuation">&gt;</span></span>example<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>SrcLayer</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GeometryType</span><span class="token punctuation">&gt;</span></span>wkbPoint<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>GeometryType</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>LayerSRS</span><span class="token punctuation">&gt;</span></span>WGS84<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>LayerSRS</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>GeometryField</span> <span class="token attr-name">encoding</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>PointFromColumns<span class="token punctuation">"</span></span> <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X<span class="token punctuation">"</span></span> <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Y<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>OGRVRTLayer</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>OGRVRTDataSource</span><span class="token punctuation">&gt;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr
ogr<span class="token punctuation">.</span>UseExceptions<span class="token punctuation">(</span><span class="token punctuation">)</span>

inDataSource <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Open<span class="token punctuation">(</span><span class="token string">"example_wrapper.vrt"</span><span class="token punctuation">)</span>
lyr <span class="token operator">=</span> inDataSource<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token string">'example'</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> feat <span class="token keyword">in</span> lyr<span class="token punctuation">:</span>
    geom <span class="token operator">=</span> feat<span class="token punctuation">.</span>GetGeometryRef<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span> <span class="token punctuation">(</span>geom<span class="token punctuation">.</span>ExportToWkt<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="计算范围"><a href="#计算范围" class="headerlink" title="计算范围"></a>计算范围</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr
<span class="token keyword">import</span> os

<span class="token comment"># Get a Layer's Extent</span>
inShapefile <span class="token operator">=</span> <span class="token string">"states.shp"</span>
inDriver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">"ESRI Shapefile"</span><span class="token punctuation">)</span>
inDataSource <span class="token operator">=</span> inDriver<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>inShapefile<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
inLayer <span class="token operator">=</span> inDataSource<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>
extent <span class="token operator">=</span> inLayer<span class="token punctuation">.</span>GetExtent<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 创建多边形</span>
ring <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Geometry<span class="token punctuation">(</span>ogr<span class="token punctuation">.</span>wkbLinearRing<span class="token punctuation">)</span>
ring<span class="token punctuation">.</span>AddPoint<span class="token punctuation">(</span>extent<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>extent<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ring<span class="token punctuation">.</span>AddPoint<span class="token punctuation">(</span>extent<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> extent<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ring<span class="token punctuation">.</span>AddPoint<span class="token punctuation">(</span>extent<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> extent<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ring<span class="token punctuation">.</span>AddPoint<span class="token punctuation">(</span>extent<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> extent<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
ring<span class="token punctuation">.</span>AddPoint<span class="token punctuation">(</span>extent<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>extent<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
poly <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Geometry<span class="token punctuation">(</span>ogr<span class="token punctuation">.</span>wkbPolygon<span class="token punctuation">)</span>
poly<span class="token punctuation">.</span>AddGeometry<span class="token punctuation">(</span>ring<span class="token punctuation">)</span>

<span class="token comment"># 保存到新的shp文件</span>
outShapefile <span class="token operator">=</span> <span class="token string">"new.shp"</span>
outDriver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">"ESRI Shapefile"</span><span class="token punctuation">)</span>

<span class="token comment"># 如果存在，先删除</span>
<span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>outShapefile<span class="token punctuation">)</span><span class="token punctuation">:</span>
    outDriver<span class="token punctuation">.</span>DeleteDataSource<span class="token punctuation">(</span>outShapefile<span class="token punctuation">)</span>

<span class="token comment"># 创建数据源</span>
outDataSource <span class="token operator">=</span> outDriver<span class="token punctuation">.</span>CreateDataSource<span class="token punctuation">(</span>outShapefile<span class="token punctuation">)</span>
outLayer <span class="token operator">=</span> outDataSource<span class="token punctuation">.</span>CreateLayer<span class="token punctuation">(</span><span class="token string">"new"</span><span class="token punctuation">,</span> geom_type<span class="token operator">=</span>ogr<span class="token punctuation">.</span>wkbPolygon<span class="token punctuation">)</span>

<span class="token comment"># 添加ID字段</span>
idField <span class="token operator">=</span> ogr<span class="token punctuation">.</span>FieldDefn<span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> ogr<span class="token punctuation">.</span>OFTInteger<span class="token punctuation">)</span>
outLayer<span class="token punctuation">.</span>CreateField<span class="token punctuation">(</span>idField<span class="token punctuation">)</span>

<span class="token comment"># 创建要素</span>
featureDefn <span class="token operator">=</span> outLayer<span class="token punctuation">.</span>GetLayerDefn<span class="token punctuation">(</span><span class="token punctuation">)</span>
feature <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Feature<span class="token punctuation">(</span>featureDefn<span class="token punctuation">)</span>
feature<span class="token punctuation">.</span>SetGeometry<span class="token punctuation">(</span>poly<span class="token punctuation">)</span>
feature<span class="token punctuation">.</span>SetField<span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
outLayer<span class="token punctuation">.</span>CreateFeature<span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
feature <span class="token operator">=</span> <span class="token boolean">None</span>

<span class="token comment"># 保存并关闭</span>
inDataSource <span class="token operator">=</span> <span class="token boolean">None</span>
outDataSource <span class="token operator">=</span> <span class="token boolean">None</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="计算凸包"><a href="#计算凸包" class="headerlink" title="计算凸包"></a>计算凸包</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="D:/py-gdalogr-cookbook-zh/docs/assets/image-20200309152509219.png" alt="image-20200309152509219"></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr
<span class="token keyword">import</span> os

<span class="token comment"># 获得图层</span>
inShapefile <span class="token operator">=</span> <span class="token string">"test.shp"</span>
inDriver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">"ESRI Shapefile"</span><span class="token punctuation">)</span>
inDataSource <span class="token operator">=</span> inDriver<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>inShapefile<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
inLayer <span class="token operator">=</span> inDataSource<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 几何集合</span>
geomcol <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Geometry<span class="token punctuation">(</span>ogr<span class="token punctuation">.</span>wkbGeometryCollection<span class="token punctuation">)</span>
<span class="token keyword">for</span> feature <span class="token keyword">in</span> inLayer<span class="token punctuation">:</span>
    geomcol<span class="token punctuation">.</span>AddGeometry<span class="token punctuation">(</span>feature<span class="token punctuation">.</span>GetGeometryRef<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 计算凸包</span>
convexhull <span class="token operator">=</span> geomcol<span class="token punctuation">.</span>ConvexHull<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 保存</span>
outShapefile <span class="token operator">=</span> <span class="token string">"test_convexhull.shp"</span>
outDriver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">"ESRI Shapefile"</span><span class="token punctuation">)</span>

<span class="token comment"># 如果存在，先删除</span>
<span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>outShapefile<span class="token punctuation">)</span><span class="token punctuation">:</span>
    outDriver<span class="token punctuation">.</span>DeleteDataSource<span class="token punctuation">(</span>outShapefile<span class="token punctuation">)</span>

<span class="token comment"># 输出</span>
outDataSource <span class="token operator">=</span> outDriver<span class="token punctuation">.</span>CreateDataSource<span class="token punctuation">(</span>outShapefile<span class="token punctuation">)</span>
outLayer <span class="token operator">=</span> outDataSource<span class="token punctuation">.</span>CreateLayer<span class="token punctuation">(</span><span class="token string">"test_convexhull"</span><span class="token punctuation">,</span> geom_type<span class="token operator">=</span>ogr<span class="token punctuation">.</span>wkbPolygon<span class="token punctuation">)</span>

<span class="token comment"># 添加ID字段</span>
idField <span class="token operator">=</span> ogr<span class="token punctuation">.</span>FieldDefn<span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> ogr<span class="token punctuation">.</span>OFTInteger<span class="token punctuation">)</span>
outLayer<span class="token punctuation">.</span>CreateField<span class="token punctuation">(</span>idField<span class="token punctuation">)</span>

<span class="token comment"># 创建要素</span>
featureDefn <span class="token operator">=</span> outLayer<span class="token punctuation">.</span>GetLayerDefn<span class="token punctuation">(</span><span class="token punctuation">)</span>
feature <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Feature<span class="token punctuation">(</span>featureDefn<span class="token punctuation">)</span>
feature<span class="token punctuation">.</span>SetGeometry<span class="token punctuation">(</span>convexhull<span class="token punctuation">)</span>
feature<span class="token punctuation">.</span>SetField<span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
outLayer<span class="token punctuation">.</span>CreateFeature<span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
feature <span class="token operator">=</span> <span class="token boolean">None</span>

<span class="token comment"># 保存并关闭</span>
inDataSource <span class="token operator">=</span> <span class="token boolean">None</span>
outDataSource <span class="token operator">=</span> <span class="token boolean">None</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="计算质心"><a href="#计算质心" class="headerlink" title="计算质心"></a>计算质心</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr
<span class="token keyword">import</span> os

ogr<span class="token punctuation">.</span>UseExceptions<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 输入图层</span>
inShapefile <span class="token operator">=</span> <span class="token string">"test.shp"</span>
inDriver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">"ESRI Shapefile"</span><span class="token punctuation">)</span>
inDataSource <span class="token operator">=</span> inDriver<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>inShapefile<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
inLayer <span class="token operator">=</span> inDataSource<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 输出图层</span>
outShapefile <span class="token operator">=</span> <span class="token string">"test_centroids.shp"</span>
outDriver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">"ESRI Shapefile"</span><span class="token punctuation">)</span>

<span class="token comment"># 如果存在，先删除</span>
<span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>outShapefile<span class="token punctuation">)</span><span class="token punctuation">:</span>
    outDriver<span class="token punctuation">.</span>DeleteDataSource<span class="token punctuation">(</span>outShapefile<span class="token punctuation">)</span>

outDataSource <span class="token operator">=</span> outDriver<span class="token punctuation">.</span>CreateDataSource<span class="token punctuation">(</span>outShapefile<span class="token punctuation">)</span>
outLayer <span class="token operator">=</span> outDataSource<span class="token punctuation">.</span>CreateLayer<span class="token punctuation">(</span><span class="token string">"test_centroids"</span><span class="token punctuation">,</span> geom_type<span class="token operator">=</span>ogr<span class="token punctuation">.</span>wkbPoint<span class="token punctuation">)</span>

<span class="token comment"># 添加字段</span>
inLayerDefn <span class="token operator">=</span> inLayer<span class="token punctuation">.</span>GetLayerDefn<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> inLayerDefn<span class="token punctuation">.</span>GetFieldCount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    fieldDefn <span class="token operator">=</span> inLayerDefn<span class="token punctuation">.</span>GetFieldDefn<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    outLayer<span class="token punctuation">.</span>CreateField<span class="token punctuation">(</span>fieldDefn<span class="token punctuation">)</span>

<span class="token comment"># 获得要素定义</span>
outLayerDefn <span class="token operator">=</span> outLayer<span class="token punctuation">.</span>GetLayerDefn<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 添加要素</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> inLayer<span class="token punctuation">.</span>GetFeatureCount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 输入要素</span>
    inFeature <span class="token operator">=</span> inLayer<span class="token punctuation">.</span>GetFeature<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token comment"># 输出要素</span>
    outFeature <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Feature<span class="token punctuation">(</span>outLayerDefn<span class="token punctuation">)</span>
    <span class="token comment"># 设置字段值</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> outLayerDefn<span class="token punctuation">.</span>GetFieldCount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        outFeature<span class="token punctuation">.</span>SetField<span class="token punctuation">(</span>outLayerDefn<span class="token punctuation">.</span>GetFieldDefn<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>GetNameRef<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> inFeature<span class="token punctuation">.</span>GetField<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 设置质心几何</span>
    geom <span class="token operator">=</span> inFeature<span class="token punctuation">.</span>GetGeometryRef<span class="token punctuation">(</span><span class="token punctuation">)</span>
    inFeature <span class="token operator">=</span> <span class="token boolean">None</span>
    centroid <span class="token operator">=</span> geom<span class="token punctuation">.</span>Centroid<span class="token punctuation">(</span><span class="token punctuation">)</span>
    outFeature<span class="token punctuation">.</span>SetGeometry<span class="token punctuation">(</span>centroid<span class="token punctuation">)</span>
    <span class="token comment"># 添加新要素</span>
    outLayer<span class="token punctuation">.</span>CreateFeature<span class="token punctuation">(</span>outFeature<span class="token punctuation">)</span>
    outFeature <span class="token operator">=</span> <span class="token boolean">None</span>

<span class="token comment"># 保存并关闭</span>
inDataSource <span class="token operator">=</span> <span class="token boolean">None</span>
outDataSource <span class="token operator">=</span> <span class="token boolean">None</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="创建新的shp数据并添加数据"><a href="#创建新的shp数据并添加数据" class="headerlink" title="创建新的shp数据并添加数据"></a>创建新的shp数据并添加数据</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> osgeo<span class="token punctuation">.</span>ogr <span class="token keyword">as</span> ogr
<span class="token keyword">import</span> osgeo<span class="token punctuation">.</span>osr <span class="token keyword">as</span> osr
<span class="token keyword">import</span> csv<span class="token punctuation">,</span>os

<span class="token comment"># 使用字典读取数据</span>
reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>DictReader<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"volcano_data.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    delimiter<span class="token operator">=</span><span class="token string">'\t'</span><span class="token punctuation">,</span>
    quoting<span class="token operator">=</span>csv<span class="token punctuation">.</span>QUOTE_NONE<span class="token punctuation">)</span>

<span class="token comment"># 驱动</span>
outShapefile<span class="token operator">=</span><span class="token string">"volcanoes.shp"</span>
driver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">"ESRI Shapefile"</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>outShapefile<span class="token punctuation">)</span><span class="token punctuation">:</span>
    driver<span class="token punctuation">.</span>DeleteDataSource<span class="token punctuation">(</span>outShapefile<span class="token punctuation">)</span>

<span class="token comment"># 创建数据源</span>
data_source <span class="token operator">=</span> driver<span class="token punctuation">.</span>CreateDataSource<span class="token punctuation">(</span>outShapefile<span class="token punctuation">)</span>

<span class="token comment"># 创建空间参考 WGS84</span>
srs <span class="token operator">=</span> osr<span class="token punctuation">.</span>SpatialReference<span class="token punctuation">(</span><span class="token punctuation">)</span>
srs<span class="token punctuation">.</span>ImportFromEPSG<span class="token punctuation">(</span><span class="token number">4326</span><span class="token punctuation">)</span>

<span class="token comment"># 创建图层</span>
layer <span class="token operator">=</span> data_source<span class="token punctuation">.</span>CreateLayer<span class="token punctuation">(</span><span class="token string">"volcanoes"</span><span class="token punctuation">,</span> srs<span class="token punctuation">,</span> ogr<span class="token punctuation">.</span>wkbPoint<span class="token punctuation">)</span>

<span class="token comment"># 添加字段</span>
field_name <span class="token operator">=</span> ogr<span class="token punctuation">.</span>FieldDefn<span class="token punctuation">(</span><span class="token string">"Name"</span><span class="token punctuation">,</span> ogr<span class="token punctuation">.</span>OFTString<span class="token punctuation">)</span>
field_name<span class="token punctuation">.</span>SetWidth<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span>
layer<span class="token punctuation">.</span>CreateField<span class="token punctuation">(</span>field_name<span class="token punctuation">)</span>
field_region <span class="token operator">=</span> ogr<span class="token punctuation">.</span>FieldDefn<span class="token punctuation">(</span><span class="token string">"Region"</span><span class="token punctuation">,</span> ogr<span class="token punctuation">.</span>OFTString<span class="token punctuation">)</span>
field_region<span class="token punctuation">.</span>SetWidth<span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span>
layer<span class="token punctuation">.</span>CreateField<span class="token punctuation">(</span>field_region<span class="token punctuation">)</span>
layer<span class="token punctuation">.</span>CreateField<span class="token punctuation">(</span>ogr<span class="token punctuation">.</span>FieldDefn<span class="token punctuation">(</span><span class="token string">"Latitude"</span><span class="token punctuation">,</span> ogr<span class="token punctuation">.</span>OFTReal<span class="token punctuation">)</span><span class="token punctuation">)</span>
layer<span class="token punctuation">.</span>CreateField<span class="token punctuation">(</span>ogr<span class="token punctuation">.</span>FieldDefn<span class="token punctuation">(</span><span class="token string">"Longitude"</span><span class="token punctuation">,</span> ogr<span class="token punctuation">.</span>OFTReal<span class="token punctuation">)</span><span class="token punctuation">)</span>
layer<span class="token punctuation">.</span>CreateField<span class="token punctuation">(</span>ogr<span class="token punctuation">.</span>FieldDefn<span class="token punctuation">(</span><span class="token string">"Elevation"</span><span class="token punctuation">,</span> ogr<span class="token punctuation">.</span>OFTInteger<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment"># 处理文本</span>
<span class="token keyword">for</span> row <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
  <span class="token comment"># 创建要素</span>
  feature <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Feature<span class="token punctuation">(</span>layer<span class="token punctuation">.</span>GetLayerDefn<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token comment"># 设置属性字段</span>
  feature<span class="token punctuation">.</span>SetField<span class="token punctuation">(</span><span class="token string">"Name"</span><span class="token punctuation">,</span> row<span class="token punctuation">[</span><span class="token string">'Name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  feature<span class="token punctuation">.</span>SetField<span class="token punctuation">(</span><span class="token string">"Region"</span><span class="token punctuation">,</span> row<span class="token punctuation">[</span><span class="token string">'Region'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  feature<span class="token punctuation">.</span>SetField<span class="token punctuation">(</span><span class="token string">"Latitude"</span><span class="token punctuation">,</span> row<span class="token punctuation">[</span><span class="token string">'Latitude'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  feature<span class="token punctuation">.</span>SetField<span class="token punctuation">(</span><span class="token string">"Longitude"</span><span class="token punctuation">,</span> row<span class="token punctuation">[</span><span class="token string">'Longitude'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
  feature<span class="token punctuation">.</span>SetField<span class="token punctuation">(</span><span class="token string">"Elevation"</span><span class="token punctuation">,</span> row<span class="token punctuation">[</span><span class="token string">'Elevation'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

  <span class="token comment"># 创建WKT</span>
  wkt <span class="token operator">=</span> <span class="token string">"POINT(%f %f)"</span> <span class="token operator">%</span>  <span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'Longitude'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">(</span>row<span class="token punctuation">[</span><span class="token string">'Latitude'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

  <span class="token comment"># 创建点</span>
  point <span class="token operator">=</span> ogr<span class="token punctuation">.</span>CreateGeometryFromWkt<span class="token punctuation">(</span>wkt<span class="token punctuation">)</span>

  <span class="token comment"># 设置几何</span>
  feature<span class="token punctuation">.</span>SetGeometry<span class="token punctuation">(</span>point<span class="token punctuation">)</span>
  <span class="token comment"># 添加要素</span>
  layer<span class="token punctuation">.</span>CreateFeature<span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
  <span class="token comment"># 删除引用</span>
  feature <span class="token operator">=</span> <span class="token boolean">None</span>

<span class="token comment"># 保存关闭</span>
data_source <span class="token operator">=</span> <span class="token boolean">None</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="从WKT创建PostGIS表"><a href="#从WKT创建PostGIS表" class="headerlink" title="从WKT创建PostGIS表"></a>从WKT创建PostGIS表</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> ogr<span class="token punctuation">,</span> osr

database <span class="token operator">=</span> <span class="token string">'test2020'</span>
usr <span class="token operator">=</span> <span class="token string">'postgres'</span>
pw <span class="token operator">=</span> <span class="token string">'123456'</span>
table <span class="token operator">=</span> <span class="token string">'testtest'</span>

wkt <span class="token operator">=</span> <span class="token string">"POINT (1120351.5712494177 741921.4223245403)"</span>
point <span class="token operator">=</span> ogr<span class="token punctuation">.</span>CreateGeometryFromWkt<span class="token punctuation">(</span>wkt<span class="token punctuation">)</span>

connectionString <span class="token operator">=</span> <span class="token string">"PG:dbname='%s' user='%s' password='%s'"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>database<span class="token punctuation">,</span>usr<span class="token punctuation">,</span>pw<span class="token punctuation">)</span>
ogrds <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>connectionString<span class="token punctuation">)</span>

srs <span class="token operator">=</span> osr<span class="token punctuation">.</span>SpatialReference<span class="token punctuation">(</span><span class="token punctuation">)</span>
srs<span class="token punctuation">.</span>ImportFromEPSG<span class="token punctuation">(</span><span class="token number">4326</span><span class="token punctuation">)</span>

layer <span class="token operator">=</span> ogrds<span class="token punctuation">.</span>CreateLayer<span class="token punctuation">(</span>table<span class="token punctuation">,</span> srs<span class="token punctuation">,</span> ogr<span class="token punctuation">.</span>wkbPoint<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'OVERWRITE=YES'</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>

layerDefn <span class="token operator">=</span> layer<span class="token punctuation">.</span>GetLayerDefn<span class="token punctuation">(</span><span class="token punctuation">)</span>

feature <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Feature<span class="token punctuation">(</span>layerDefn<span class="token punctuation">)</span>
feature<span class="token punctuation">.</span>SetGeometry<span class="token punctuation">(</span>point<span class="token punctuation">)</span>

layer<span class="token punctuation">.</span>StartTransaction<span class="token punctuation">(</span><span class="token punctuation">)</span>
layer<span class="token punctuation">.</span>CreateFeature<span class="token punctuation">(</span>feature<span class="token punctuation">)</span>
feature <span class="token operator">=</span> <span class="token boolean">None</span>
layer<span class="token punctuation">.</span>CommitTransaction<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="过滤和选择"><a href="#过滤和选择" class="headerlink" title="过滤和选择"></a>过滤和选择</h2><pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">ogr2ogr -f "ESRI Shapefile" junkmob.shp -select area -where "area = 5268.813" test.shp

# 该命令读取parcel_address.shp并生成junkmob.shp，area=5268.813输出area列<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> osgeo <span class="token keyword">import</span> ogr
<span class="token keyword">import</span> os<span class="token punctuation">,</span> sys

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span> field_name_target <span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># 输入图层</span>
    inShapefile <span class="token operator">=</span> <span class="token string">"test.shp"</span>
    inDriver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">"ESRI Shapefile"</span><span class="token punctuation">)</span>
    inDataSource <span class="token operator">=</span> inDriver<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>inShapefile<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
    inLayer <span class="token operator">=</span> inDataSource<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>
    inLayer<span class="token punctuation">.</span>SetAttributeFilter<span class="token punctuation">(</span><span class="token string">"area = 5268.813"</span><span class="token punctuation">)</span>

    <span class="token comment"># 创建输出图层</span>
    outShapefile <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>split<span class="token punctuation">(</span> inShapefile <span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"junkmob.shp"</span> <span class="token punctuation">)</span>
    outDriver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">"ESRI Shapefile"</span><span class="token punctuation">)</span>

    <span class="token comment"># 存在，先删除</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>outShapefile<span class="token punctuation">)</span><span class="token punctuation">:</span>
        outDriver<span class="token punctuation">.</span>DeleteDataSource<span class="token punctuation">(</span>outShapefile<span class="token punctuation">)</span>

    <span class="token comment"># 创建输出shp</span>
    outDataSource <span class="token operator">=</span> outDriver<span class="token punctuation">.</span>CreateDataSource<span class="token punctuation">(</span>outShapefile<span class="token punctuation">)</span>
    out_lyr_name <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>splitext<span class="token punctuation">(</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>split<span class="token punctuation">(</span> outShapefile <span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    outLayer <span class="token operator">=</span> outDataSource<span class="token punctuation">.</span>CreateLayer<span class="token punctuation">(</span> out_lyr_name<span class="token punctuation">,</span> geom_type<span class="token operator">=</span>ogr<span class="token punctuation">.</span>wkbMultiPolygon <span class="token punctuation">)</span>

    <span class="token comment"># 添加字段</span>
    inLayerDefn <span class="token operator">=</span> inLayer<span class="token punctuation">.</span>GetLayerDefn<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> inLayerDefn<span class="token punctuation">.</span>GetFieldCount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        fieldDefn <span class="token operator">=</span> inLayerDefn<span class="token punctuation">.</span>GetFieldDefn<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        fieldName <span class="token operator">=</span> fieldDefn<span class="token punctuation">.</span>GetName<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> fieldName <span class="token keyword">not</span> <span class="token keyword">in</span> field_name_target<span class="token punctuation">:</span>
            <span class="token keyword">continue</span>
        outLayer<span class="token punctuation">.</span>CreateField<span class="token punctuation">(</span>fieldDefn<span class="token punctuation">)</span>

    <span class="token comment"># 要素定义</span>
    outLayerDefn <span class="token operator">=</span> outLayer<span class="token punctuation">.</span>GetLayerDefn<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># 添加要素</span>
    <span class="token keyword">for</span> inFeature <span class="token keyword">in</span> inLayer<span class="token punctuation">:</span>
        <span class="token comment"># 创建要素</span>
        outFeature <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Feature<span class="token punctuation">(</span>outLayerDefn<span class="token punctuation">)</span>

        <span class="token comment"># 添加字段</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> outLayerDefn<span class="token punctuation">.</span>GetFieldCount<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            fieldDefn <span class="token operator">=</span> outLayerDefn<span class="token punctuation">.</span>GetFieldDefn<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
            fieldName <span class="token operator">=</span> fieldDefn<span class="token punctuation">.</span>GetName<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> fieldName <span class="token keyword">not</span> <span class="token keyword">in</span> field_name_target<span class="token punctuation">:</span>
                <span class="token keyword">continue</span>

            outFeature<span class="token punctuation">.</span>SetField<span class="token punctuation">(</span>outLayerDefn<span class="token punctuation">.</span>GetFieldDefn<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">.</span>GetNameRef<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                inFeature<span class="token punctuation">.</span>GetField<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token comment"># 设置几何</span>
        geom <span class="token operator">=</span> inFeature<span class="token punctuation">.</span>GetGeometryRef<span class="token punctuation">(</span><span class="token punctuation">)</span>
        outFeature<span class="token punctuation">.</span>SetGeometry<span class="token punctuation">(</span>geom<span class="token punctuation">.</span>Clone<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 创建要素</span>
        outLayer<span class="token punctuation">.</span>CreateFeature<span class="token punctuation">(</span>outFeature<span class="token punctuation">)</span>
        outFeature <span class="token operator">=</span> <span class="token boolean">None</span>

    <span class="token comment"># 保存关闭</span>
    inDataSource <span class="token operator">=</span> <span class="token boolean">None</span>
    outDataSource <span class="token operator">=</span> <span class="token boolean">None</span>


main<span class="token punctuation">(</span> <span class="token punctuation">[</span><span class="token string">"AREA"</span><span class="token punctuation">,</span><span class="token string">"EAS_ID"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="合并图层"><a href="#合并图层" class="headerlink" title="合并图层"></a>合并图层</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token punctuation">,</span> ogr<span class="token punctuation">,</span> osr

outputMergefn <span class="token operator">=</span> <span class="token string">'merge.shp'</span>
directory <span class="token operator">=</span> <span class="token string">"/Users/UserName/Downloads/"</span>
fileStartsWith <span class="token operator">=</span> <span class="token string">'test'</span>
fileEndsWith <span class="token operator">=</span> <span class="token string">'.shp'</span>
driverName <span class="token operator">=</span> <span class="token string">'ESRI Shapefile'</span>
geometryType <span class="token operator">=</span> ogr<span class="token punctuation">.</span>wkbPolygon

out_driver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span> driverName <span class="token punctuation">)</span>
<span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>outputMergefn<span class="token punctuation">)</span><span class="token punctuation">:</span>
    out_driver<span class="token punctuation">.</span>DeleteDataSource<span class="token punctuation">(</span>outputMergefn<span class="token punctuation">)</span>
out_ds <span class="token operator">=</span> out_driver<span class="token punctuation">.</span>CreateDataSource<span class="token punctuation">(</span>outputMergefn<span class="token punctuation">)</span>
out_layer <span class="token operator">=</span> out_ds<span class="token punctuation">.</span>CreateLayer<span class="token punctuation">(</span>outputMergefn<span class="token punctuation">,</span> geom_type<span class="token operator">=</span>geometryType<span class="token punctuation">)</span>

fileList <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>directory<span class="token punctuation">)</span>

<span class="token keyword">for</span> <span class="token builtin">file</span> <span class="token keyword">in</span> fileList<span class="token punctuation">:</span>
    <span class="token keyword">if</span> <span class="token builtin">file</span><span class="token punctuation">.</span>startswith<span class="token punctuation">(</span>fileStartsWith<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token builtin">file</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span>fileEndsWith<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token builtin">file</span>
        ds <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>directory<span class="token operator">+</span><span class="token builtin">file</span><span class="token punctuation">)</span>
        lyr <span class="token operator">=</span> ds<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> feat <span class="token keyword">in</span> lyr<span class="token punctuation">:</span>
            out_feat <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Feature<span class="token punctuation">(</span>out_layer<span class="token punctuation">.</span>GetLayerDefn<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            out_feat<span class="token punctuation">.</span>SetGeometry<span class="token punctuation">(</span>feat<span class="token punctuation">.</span>GetGeometryRef<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Clone<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            out_layer<span class="token punctuation">.</span>CreateFeature<span class="token punctuation">(</span>out_feat<span class="token punctuation">)</span>
            out_feat <span class="token operator">=</span> <span class="token boolean">None</span>
            out_layer<span class="token punctuation">.</span>SyncToDisk<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="获取OSM街道名称"><a href="#获取OSM街道名称" class="headerlink" title="获取OSM街道名称"></a>获取OSM街道名称</h2><p>TODO：测试</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> ogr

ds <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Open<span class="token punctuation">(</span><span class="token string">'test.osm'</span><span class="token punctuation">)</span>
layer <span class="token operator">=</span> ds<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>

nameList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> feature <span class="token keyword">in</span> layer<span class="token punctuation">:</span>
    <span class="token keyword">if</span> feature<span class="token punctuation">.</span>GetField<span class="token punctuation">(</span><span class="token string">"highway"</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        name <span class="token operator">=</span> feature<span class="token punctuation">.</span>GetField<span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> name <span class="token operator">!=</span> <span class="token boolean">None</span> <span class="token keyword">and</span> name <span class="token keyword">not</span> <span class="token keyword">in</span> nameList<span class="token punctuation">:</span>
            nameList<span class="token punctuation">.</span>append<span class="token punctuation">(</span>name<span class="token punctuation">)</span>

<span class="token keyword">print</span> <span class="token punctuation">(</span>nameList<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="创建鱼网"><a href="#创建鱼网" class="headerlink" title="创建鱼网"></a>创建鱼网</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os<span class="token punctuation">,</span> sys
<span class="token keyword">import</span> ogr
<span class="token keyword">from</span> math <span class="token keyword">import</span> ceil


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>outputGridfn<span class="token punctuation">,</span>xmin<span class="token punctuation">,</span>xmax<span class="token punctuation">,</span>ymin<span class="token punctuation">,</span>ymax<span class="token punctuation">,</span>gridHeight<span class="token punctuation">,</span>gridWidth<span class="token punctuation">)</span><span class="token punctuation">:</span>
    xmin <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>xmin<span class="token punctuation">)</span>
    xmax <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>xmax<span class="token punctuation">)</span>
    ymin <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>ymin<span class="token punctuation">)</span>
    ymax <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>ymax<span class="token punctuation">)</span>
    gridWidth <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>gridWidth<span class="token punctuation">)</span>
    gridHeight <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>gridHeight<span class="token punctuation">)</span>

    <span class="token comment"># get rows</span>
    rows <span class="token operator">=</span> ceil<span class="token punctuation">(</span><span class="token punctuation">(</span>ymax<span class="token operator">-</span>ymin<span class="token punctuation">)</span><span class="token operator">/</span>gridHeight<span class="token punctuation">)</span>
    <span class="token comment"># get columns</span>
    cols <span class="token operator">=</span> ceil<span class="token punctuation">(</span><span class="token punctuation">(</span>xmax<span class="token operator">-</span>xmin<span class="token punctuation">)</span><span class="token operator">/</span>gridWidth<span class="token punctuation">)</span>

    <span class="token comment"># start grid cell envelope</span>
    ringXleftOrigin <span class="token operator">=</span> xmin
    ringXrightOrigin <span class="token operator">=</span> xmin <span class="token operator">+</span> gridWidth
    ringYtopOrigin <span class="token operator">=</span> ymax
    ringYbottomOrigin <span class="token operator">=</span> ymax<span class="token operator">-</span>gridHeight

    <span class="token comment"># create output file</span>
    outDriver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">'ESRI Shapefile'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>outputGridfn<span class="token punctuation">)</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span>outputGridfn<span class="token punctuation">)</span>
    outDataSource <span class="token operator">=</span> outDriver<span class="token punctuation">.</span>CreateDataSource<span class="token punctuation">(</span>outputGridfn<span class="token punctuation">)</span>
    outLayer <span class="token operator">=</span> outDataSource<span class="token punctuation">.</span>CreateLayer<span class="token punctuation">(</span>outputGridfn<span class="token punctuation">,</span>geom_type<span class="token operator">=</span>ogr<span class="token punctuation">.</span>wkbPolygon <span class="token punctuation">)</span>
    featureDefn <span class="token operator">=</span> outLayer<span class="token punctuation">.</span>GetLayerDefn<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># create grid cells</span>
    countcols <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">while</span> countcols <span class="token operator">&lt;</span> cols<span class="token punctuation">:</span>
        countcols <span class="token operator">+=</span> <span class="token number">1</span>

        <span class="token comment"># reset envelope for rows</span>
        ringYtop <span class="token operator">=</span> ringYtopOrigin
        ringYbottom <span class="token operator">=</span>ringYbottomOrigin
        countrows <span class="token operator">=</span> <span class="token number">0</span>

        <span class="token keyword">while</span> countrows <span class="token operator">&lt;</span> rows<span class="token punctuation">:</span>
            countrows <span class="token operator">+=</span> <span class="token number">1</span>
            ring <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Geometry<span class="token punctuation">(</span>ogr<span class="token punctuation">.</span>wkbLinearRing<span class="token punctuation">)</span>
            ring<span class="token punctuation">.</span>AddPoint<span class="token punctuation">(</span>ringXleftOrigin<span class="token punctuation">,</span> ringYtop<span class="token punctuation">)</span>
            ring<span class="token punctuation">.</span>AddPoint<span class="token punctuation">(</span>ringXrightOrigin<span class="token punctuation">,</span> ringYtop<span class="token punctuation">)</span>
            ring<span class="token punctuation">.</span>AddPoint<span class="token punctuation">(</span>ringXrightOrigin<span class="token punctuation">,</span> ringYbottom<span class="token punctuation">)</span>
            ring<span class="token punctuation">.</span>AddPoint<span class="token punctuation">(</span>ringXleftOrigin<span class="token punctuation">,</span> ringYbottom<span class="token punctuation">)</span>
            ring<span class="token punctuation">.</span>AddPoint<span class="token punctuation">(</span>ringXleftOrigin<span class="token punctuation">,</span> ringYtop<span class="token punctuation">)</span>
            poly <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Geometry<span class="token punctuation">(</span>ogr<span class="token punctuation">.</span>wkbPolygon<span class="token punctuation">)</span>
            poly<span class="token punctuation">.</span>AddGeometry<span class="token punctuation">(</span>ring<span class="token punctuation">)</span>

            <span class="token comment"># add new geom to layer</span>
            outFeature <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Feature<span class="token punctuation">(</span>featureDefn<span class="token punctuation">)</span>
            outFeature<span class="token punctuation">.</span>SetGeometry<span class="token punctuation">(</span>poly<span class="token punctuation">)</span>
            outLayer<span class="token punctuation">.</span>CreateFeature<span class="token punctuation">(</span>outFeature<span class="token punctuation">)</span>
            outFeature <span class="token operator">=</span> <span class="token boolean">None</span>

            <span class="token comment"># new envelope for next poly</span>
            ringYtop <span class="token operator">=</span> ringYtop <span class="token operator">-</span> gridHeight
            ringYbottom <span class="token operator">=</span> ringYbottom <span class="token operator">-</span> gridHeight

        <span class="token comment"># new envelope for next poly</span>
        ringXleftOrigin <span class="token operator">=</span> ringXleftOrigin <span class="token operator">+</span> gridWidth
        ringXrightOrigin <span class="token operator">=</span> ringXrightOrigin <span class="token operator">+</span> gridWidth

    <span class="token comment"># Save and close DataSources</span>
    outDataSource <span class="token operator">=</span> <span class="token boolean">None</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>

    <span class="token comment">#</span>
    <span class="token comment"># example run : $ python grid.py &lt;full-path&gt;&lt;output-shapefile-name&gt;.shp xmin xmax ymin ymax gridHeight gridWidth</span>
    <span class="token comment">#</span>

    <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span> sys<span class="token punctuation">.</span>argv <span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">8</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token string">"[ ERROR ] you must supply seven arguments: output-shapefile-name.shp xmin xmax ymin ymax gridHeight gridWidth"</span>
        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span> <span class="token number">1</span> <span class="token punctuation">)</span>

    main<span class="token punctuation">(</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="面转线"><a href="#面转线" class="headerlink" title="面转线"></a>面转线</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> ogr<span class="token punctuation">,</span> os

<span class="token keyword">def</span> <span class="token function">poly2line</span><span class="token punctuation">(</span>input_poly<span class="token punctuation">,</span>output_line<span class="token punctuation">)</span><span class="token punctuation">:</span>

    source_ds <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>input_poly<span class="token punctuation">)</span>
    source_layer <span class="token operator">=</span> source_ds<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># polygon2geometryCollection</span>
    geomcol <span class="token operator">=</span>  ogr<span class="token punctuation">.</span>Geometry<span class="token punctuation">(</span>ogr<span class="token punctuation">.</span>wkbGeometryCollection<span class="token punctuation">)</span>
    <span class="token keyword">for</span> feat <span class="token keyword">in</span> source_layer<span class="token punctuation">:</span>
        geom <span class="token operator">=</span> feat<span class="token punctuation">.</span>GetGeometryRef<span class="token punctuation">(</span><span class="token punctuation">)</span>
        ring <span class="token operator">=</span> geom<span class="token punctuation">.</span>GetGeometryRef<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
        geomcol<span class="token punctuation">.</span>AddGeometry<span class="token punctuation">(</span>ring<span class="token punctuation">)</span>

    <span class="token comment"># geometryCollection2shp</span>
    shpDriver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">"ESRI Shapefile"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>output_line<span class="token punctuation">)</span><span class="token punctuation">:</span>
            shpDriver<span class="token punctuation">.</span>DeleteDataSource<span class="token punctuation">(</span>output_line<span class="token punctuation">)</span>
    outDataSource <span class="token operator">=</span> shpDriver<span class="token punctuation">.</span>CreateDataSource<span class="token punctuation">(</span>output_line<span class="token punctuation">)</span>
    outLayer <span class="token operator">=</span> outDataSource<span class="token punctuation">.</span>CreateLayer<span class="token punctuation">(</span>output_line<span class="token punctuation">,</span> geom_type<span class="token operator">=</span>ogr<span class="token punctuation">.</span>wkbMultiLineString<span class="token punctuation">)</span>
    featureDefn <span class="token operator">=</span> outLayer<span class="token punctuation">.</span>GetLayerDefn<span class="token punctuation">(</span><span class="token punctuation">)</span>
    outFeature <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Feature<span class="token punctuation">(</span>featureDefn<span class="token punctuation">)</span>
    outFeature<span class="token punctuation">.</span>SetGeometry<span class="token punctuation">(</span>geomcol<span class="token punctuation">)</span>
    outLayer<span class="token punctuation">.</span>CreateFeature<span class="token punctuation">(</span>outFeature<span class="token punctuation">)</span>
    outFeature <span class="token operator">=</span> <span class="token boolean">None</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>input_poly<span class="token punctuation">,</span>output_line<span class="token punctuation">)</span><span class="token punctuation">:</span>
    poly2line<span class="token punctuation">(</span>input_poly<span class="token punctuation">,</span>output_line<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    input_poly <span class="token operator">=</span> <span class="token string">'test_polygon.shp'</span>
    output_line <span class="token operator">=</span> <span class="token string">'test_line.shp'</span>

    main<span class="token punctuation">(</span>input_poly<span class="token punctuation">,</span>output_line<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="创建缓冲区"><a href="#创建缓冲区" class="headerlink" title="创建缓冲区"></a>创建缓冲区</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> ogr<span class="token punctuation">,</span> os

<span class="token keyword">def</span> <span class="token function">createBuffer</span><span class="token punctuation">(</span>inputfn<span class="token punctuation">,</span> outputBufferfn<span class="token punctuation">,</span> bufferDist<span class="token punctuation">)</span><span class="token punctuation">:</span>
    inputds <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>inputfn<span class="token punctuation">)</span>
    inputlyr <span class="token operator">=</span> inputds<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>

    shpdriver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">'ESRI Shapefile'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span>outputBufferfn<span class="token punctuation">)</span><span class="token punctuation">:</span>
        shpdriver<span class="token punctuation">.</span>DeleteDataSource<span class="token punctuation">(</span>outputBufferfn<span class="token punctuation">)</span>
    outputBufferds <span class="token operator">=</span> shpdriver<span class="token punctuation">.</span>CreateDataSource<span class="token punctuation">(</span>outputBufferfn<span class="token punctuation">)</span>
    bufferlyr <span class="token operator">=</span> outputBufferds<span class="token punctuation">.</span>CreateLayer<span class="token punctuation">(</span>outputBufferfn<span class="token punctuation">,</span> geom_type<span class="token operator">=</span>ogr<span class="token punctuation">.</span>wkbPolygon<span class="token punctuation">)</span>
    featureDefn <span class="token operator">=</span> bufferlyr<span class="token punctuation">.</span>GetLayerDefn<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> feature <span class="token keyword">in</span> inputlyr<span class="token punctuation">:</span>
        ingeom <span class="token operator">=</span> feature<span class="token punctuation">.</span>GetGeometryRef<span class="token punctuation">(</span><span class="token punctuation">)</span>
        geomBuffer <span class="token operator">=</span> ingeom<span class="token punctuation">.</span>Buffer<span class="token punctuation">(</span>bufferDist<span class="token punctuation">)</span>

        outFeature <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Feature<span class="token punctuation">(</span>featureDefn<span class="token punctuation">)</span>
        outFeature<span class="token punctuation">.</span>SetGeometry<span class="token punctuation">(</span>geomBuffer<span class="token punctuation">)</span>
        bufferlyr<span class="token punctuation">.</span>CreateFeature<span class="token punctuation">(</span>outFeature<span class="token punctuation">)</span>
        outFeature <span class="token operator">=</span> <span class="token boolean">None</span>

<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>inputfn<span class="token punctuation">,</span> outputBufferfn<span class="token punctuation">,</span> bufferDist<span class="token punctuation">)</span><span class="token punctuation">:</span>
    createBuffer<span class="token punctuation">(</span>inputfn<span class="token punctuation">,</span> outputBufferfn<span class="token punctuation">,</span> bufferDist<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    inputfn <span class="token operator">=</span> <span class="token string">'test.shp'</span>
    outputBufferfn <span class="token operator">=</span> <span class="token string">'testBuffer.shp'</span>
    bufferDist <span class="token operator">=</span> <span class="token number">10.0</span>

    main<span class="token punctuation">(</span>inputfn<span class="token punctuation">,</span> outputBufferfn<span class="token punctuation">,</span> bufferDist<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="栅格化矢量图层"><a href="#栅格化矢量图层" class="headerlink" title="栅格化矢量图层"></a>栅格化矢量图层</h2><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> ogr<span class="token punctuation">,</span> gdal

vector_fn <span class="token operator">=</span> <span class="token string">'test.shp'</span>

<span class="token comment"># 定义像素大小和无效值</span>
pixel_size <span class="token operator">=</span> <span class="token number">25</span>
NoData_value <span class="token operator">=</span> <span class="token number">255</span>

<span class="token comment"># 打开数据源，读取数据范围</span>
source_ds <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>vector_fn<span class="token punctuation">)</span>
source_layer <span class="token operator">=</span> source_ds<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>
source_srs <span class="token operator">=</span> source_layer<span class="token punctuation">.</span>GetSpatialRef<span class="token punctuation">(</span><span class="token punctuation">)</span>
x_min<span class="token punctuation">,</span> x_max<span class="token punctuation">,</span> y_min<span class="token punctuation">,</span> y_max <span class="token operator">=</span> source_layer<span class="token punctuation">.</span>GetExtent<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># 创建目标数据源</span>
x_res <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x_max <span class="token operator">-</span> x_min<span class="token punctuation">)</span> <span class="token operator">/</span> pixel_size<span class="token punctuation">)</span>
y_res <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y_max <span class="token operator">-</span> y_min<span class="token punctuation">)</span> <span class="token operator">/</span> pixel_size<span class="token punctuation">)</span>
target_ds <span class="token operator">=</span> gdal<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">'MEM'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Create<span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> x_res<span class="token punctuation">,</span> y_res<span class="token punctuation">,</span> gdal<span class="token punctuation">.</span>GDT_Byte<span class="token punctuation">)</span>
target_ds<span class="token punctuation">.</span>SetGeoTransform<span class="token punctuation">(</span><span class="token punctuation">(</span>x_min<span class="token punctuation">,</span> pixel_size<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> y_max<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>pixel_size<span class="token punctuation">)</span><span class="token punctuation">)</span>
band <span class="token operator">=</span> target_ds<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
band<span class="token punctuation">.</span>SetNoDataValue<span class="token punctuation">(</span>NoData_value<span class="token punctuation">)</span>

<span class="token comment"># 栅格化</span>
gdal<span class="token punctuation">.</span>RasterizeLayer<span class="token punctuation">(</span>target_ds<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> source_layer<span class="token punctuation">,</span> burn_values<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 读取为数组</span>
array <span class="token operator">=</span> band<span class="token punctuation">.</span>ReadAsArray<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span> <span class="token punctuation">(</span>array<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="面转点"><a href="#面转点" class="headerlink" title="面转点"></a>面转点</h2><p>TODO：测试</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> ogr<span class="token punctuation">,</span> gdal
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> os

polygon_fn <span class="token operator">=</span> <span class="token string">'test.shp'</span>

<span class="token comment"># Define pixel_size which equals distance betweens points</span>
pixel_size <span class="token operator">=</span> <span class="token number">10</span>

<span class="token comment"># Open the data source and read in the extent</span>
source_ds <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Open<span class="token punctuation">(</span>polygon_fn<span class="token punctuation">)</span>
source_layer <span class="token operator">=</span> source_ds<span class="token punctuation">.</span>GetLayer<span class="token punctuation">(</span><span class="token punctuation">)</span>
x_min<span class="token punctuation">,</span> x_max<span class="token punctuation">,</span> y_min<span class="token punctuation">,</span> y_max <span class="token operator">=</span> source_layer<span class="token punctuation">.</span>GetExtent<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Create the destination data source</span>
x_res <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>x_max <span class="token operator">-</span> x_min<span class="token punctuation">)</span> <span class="token operator">/</span> pixel_size<span class="token punctuation">)</span>
y_res <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>y_max <span class="token operator">-</span> y_min<span class="token punctuation">)</span> <span class="token operator">/</span> pixel_size<span class="token punctuation">)</span>
target_ds <span class="token operator">=</span> gdal<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">'GTiff'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Create<span class="token punctuation">(</span><span class="token string">'temp.tif'</span><span class="token punctuation">,</span> x_res<span class="token punctuation">,</span> y_res<span class="token punctuation">,</span> gdal<span class="token punctuation">.</span>GDT_Byte<span class="token punctuation">)</span>
target_ds<span class="token punctuation">.</span>SetGeoTransform<span class="token punctuation">(</span><span class="token punctuation">(</span>x_min<span class="token punctuation">,</span> pixel_size<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> y_max<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span>pixel_size<span class="token punctuation">)</span><span class="token punctuation">)</span>
band <span class="token operator">=</span> target_ds<span class="token punctuation">.</span>GetRasterBand<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
band<span class="token punctuation">.</span>SetNoDataValue<span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span>

<span class="token comment"># Rasterize</span>
gdal<span class="token punctuation">.</span>RasterizeLayer<span class="token punctuation">(</span>target_ds<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> source_layer<span class="token punctuation">,</span> burn_values<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># Read as array</span>
array <span class="token operator">=</span> band<span class="token punctuation">.</span>ReadAsArray<span class="token punctuation">(</span><span class="token punctuation">)</span>

raster <span class="token operator">=</span> gdal<span class="token punctuation">.</span>Open<span class="token punctuation">(</span><span class="token string">'temp.tif'</span><span class="token punctuation">)</span>
geotransform <span class="token operator">=</span> raster<span class="token punctuation">.</span>GetGeoTransform<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment"># Convert array to point coordinates</span>
count <span class="token operator">=</span> <span class="token number">0</span>
roadList <span class="token operator">=</span> np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>array <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>
multipoint <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Geometry<span class="token punctuation">(</span>ogr<span class="token punctuation">.</span>wkbMultiPoint<span class="token punctuation">)</span>
<span class="token keyword">for</span> indexY <span class="token keyword">in</span> roadList<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
    indexX <span class="token operator">=</span> roadList<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span>count<span class="token punctuation">]</span>
    geotransform <span class="token operator">=</span> raster<span class="token punctuation">.</span>GetGeoTransform<span class="token punctuation">(</span><span class="token punctuation">)</span>
    originX <span class="token operator">=</span> geotransform<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    originY <span class="token operator">=</span> geotransform<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span>
    pixelWidth <span class="token operator">=</span> geotransform<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    pixelHeight <span class="token operator">=</span> geotransform<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span>
    Xcoord <span class="token operator">=</span> originX<span class="token operator">+</span>pixelWidth<span class="token operator">*</span>indexX
    Ycoord <span class="token operator">=</span> originY<span class="token operator">+</span>pixelHeight<span class="token operator">*</span>indexY
    point <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Geometry<span class="token punctuation">(</span>ogr<span class="token punctuation">.</span>wkbPoint<span class="token punctuation">)</span>
    point<span class="token punctuation">.</span>AddPoint<span class="token punctuation">(</span>Xcoord<span class="token punctuation">,</span> Ycoord<span class="token punctuation">)</span>
    multipoint<span class="token punctuation">.</span>AddGeometry<span class="token punctuation">(</span>point<span class="token punctuation">)</span>
    count <span class="token operator">+=</span> <span class="token number">1</span>

<span class="token comment"># Write point coordinates to Shapefile</span>
shpDriver <span class="token operator">=</span> ogr<span class="token punctuation">.</span>GetDriverByName<span class="token punctuation">(</span><span class="token string">"ESRI Shapefile"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>exists<span class="token punctuation">(</span><span class="token string">'points.shp'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    shpDriver<span class="token punctuation">.</span>DeleteDataSource<span class="token punctuation">(</span><span class="token string">'points.shp'</span><span class="token punctuation">)</span>
outDataSource <span class="token operator">=</span> shpDriver<span class="token punctuation">.</span>CreateDataSource<span class="token punctuation">(</span><span class="token string">'points.shp'</span><span class="token punctuation">)</span>
outLayer <span class="token operator">=</span> outDataSource<span class="token punctuation">.</span>CreateLayer<span class="token punctuation">(</span><span class="token string">'points.shp'</span><span class="token punctuation">,</span> geom_type<span class="token operator">=</span>ogr<span class="token punctuation">.</span>wkbMultiPoint<span class="token punctuation">)</span>
featureDefn <span class="token operator">=</span> outLayer<span class="token punctuation">.</span>GetLayerDefn<span class="token punctuation">(</span><span class="token punctuation">)</span>
outFeature <span class="token operator">=</span> ogr<span class="token punctuation">.</span>Feature<span class="token punctuation">(</span>featureDefn<span class="token punctuation">)</span>
outFeature<span class="token punctuation">.</span>SetGeometry<span class="token punctuation">(</span>multipoint<span class="token punctuation">)</span>
outLayer<span class="token punctuation">.</span>CreateFeature<span class="token punctuation">(</span>outFeature<span class="token punctuation">)</span>
outFeature <span class="token operator">=</span> <span class="token boolean">None</span>

<span class="token comment"># Remove temporary files</span>
os<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token string">'temp.tif'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">ytkz</div><div class="post-copyright__author_desc">Some personal notes</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://ytkz11@.github.io/2025/07/10/gdal-ogr-jian-dan-de-shi-yong-jiao-cheng/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://ytkz11@.github.io/2025/07/10/gdal-ogr-jian-dan-de-shi-yong-jiao-cheng/')">GDAL_OGR简单的使用教程</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/null" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/null" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/null" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://ytkz11@.github.io/2025/07/10/gdal-ogr-jian-dan-de-shi-yong-jiao-cheng/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=GDAL_OGR简单的使用教程&amp;url=http://ytkz11@.github.io/2025/07/10/gdal-ogr-jian-dan-de-shi-yong-jiao-cheng/&amp;pic=https://cdn.jsdelivr.net/gh/ytkz11/picture/imgs202507161641982.png" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://ytkz11@.github.io" target="_blank">Find everything you need</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E9%81%A5%E6%84%9F/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>遥感<span class="tagsPageCount">183</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/gh/ytkz11/picture/imgs202507111500105.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/07/10/yao-gan-dao-di-shi-ge-sha/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/ytkz11/picture/imgs202507101625855.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">遥感到底是个啥</div></div></a></div><div class="next-post pull-right"><a href="/2025/07/11/jian-yao-jie-shao-gdal-de-jia-gou-guan-jian-zu-jian-he-gong-neng/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/ytkz11/picture/imgs202507111438678.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">简要介绍 GDAL 的架构、关键组件和功能</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2021/03/10/gdal-api-bi-ji/" title="gdal api笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://z3.ax1x.com/2021/01/11/s8Nhmn.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2021-03-10</div><div class="title">gdal api笔记</div></div></a></div><div><a href="/2025/07/16/xue-xi-rasterio-huan-shi-gdal/" title="学习Rasterio还是GDAL？"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/ytkz11/picture/imgs202507161641974.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-16</div><div class="title">学习Rasterio还是GDAL？</div></div></a></div><div><a href="/2025/07/11/gao-bie-gdal-translate-ying-jie-gdal-tong-yi-ming-ling-xing-xin-shi-dai/" title="告别 gdal_translate：迎接 GDAL 统一命令行新时代"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/ytkz11/picture/imgs202507111500105.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-11</div><div class="title">告别 gdal_translate：迎接 GDAL 统一命令行新时代</div></div></a></div><div><a href="/2025/07/11/jian-yao-jie-shao-gdal-de-jia-gou-guan-jian-zu-jian-he-gong-neng/" title="简要介绍 GDAL 的架构、关键组件和功能"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/ytkz11/picture/imgs202507111438678.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-11</div><div class="title">简要介绍 GDAL 的架构、关键组件和功能</div></div></a></div><div><a href="/2025/07/10/yao-gan-dao-di-shi-ge-sha/" title="遥感到底是个啥"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/ytkz11/picture/imgs202507101625855.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-10</div><div class="title">遥感到底是个啥</div></div></a></div><div><a href="/2025/06/24/pan-duan-rgb-yao-gan-ying-xiang-de-bo-duan-shi-fou-zheng-que-de-fang-fa/" title="lee滤波对于sar影像去噪非常有用"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/ytkz11/picture/imgs202506242113681.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-24</div><div class="title">lee滤波对于sar影像去噪非常有用</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__description"></div></div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://raw.githubusercontent.com/ytkz11/picture/e0561f27bb351a8dc757d4f5b1d74a1ab5ef4e42/imgs202411281530223.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#GDAL-OGR%E7%AE%80%E5%8D%95%E7%9A%84%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B"><span class="toc-number">1.</span> <span class="toc-text">GDAL_OGR简单的使用教程</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%B5%8B%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.</span> <span class="toc-text">检测安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E7%89%88%E6%9C%AC"><span class="toc-number">1.2.</span> <span class="toc-text">查看版本</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%90%AFpython%E5%BC%82%E5%B8%B8"><span class="toc-number">1.3.</span> <span class="toc-text">开启python异常</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85GDAL-OGR%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86"><span class="toc-number">1.4.</span> <span class="toc-text">安装GDAL OGR错误处理</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A0%85%E6%A0%BC%E5%9B%BE%E5%B1%82"><span class="toc-number">2.</span> <span class="toc-text">栅格图层</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E6%A0%85%E6%A0%BC%E6%95%B0%E6%8D%AE"><span class="toc-number">2.1.</span> <span class="toc-text">关闭栅格数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.</span> <span class="toc-text">获取元数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A2%E6%AE%B5%E8%9E%8D%E5%90%88"><span class="toc-number">2.3.</span> <span class="toc-text">波段融合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%B3%A2%E6%AE%B5"><span class="toc-number">2.4.</span> <span class="toc-text">获取波段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%81%8D%E5%8E%86%E6%B3%A2%E6%AE%B5"><span class="toc-number">2.5.</span> <span class="toc-text">遍历波段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%B3%A2%E6%AE%B5%E4%BF%A1%E6%81%AF"><span class="toc-number">2.6.</span> <span class="toc-text">获取波段信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E8%BE%B9%E5%BD%A2%E5%8C%96%E6%A0%85%E6%A0%BC%E6%B3%A2%E6%AE%B5"><span class="toc-number">2.7.</span> <span class="toc-text">多边形化栅格波段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%85%E6%A0%BC%E5%8C%96%E7%9F%A2%E9%87%8F%E6%95%B0%E6%8D%AE"><span class="toc-number">2.8.</span> <span class="toc-text">栅格化矢量数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%94%A8shapefile%E8%A3%81%E5%89%AA%E6%A0%85%E6%A0%BC"><span class="toc-number">2.9.</span> <span class="toc-text">用shapefile裁剪栅格</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8C%BA%E5%9F%9F%E7%BB%9F%E8%AE%A1"><span class="toc-number">2.10.</span> <span class="toc-text">区域统计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8E%E6%95%B0%E7%BB%84%E5%88%9B%E5%BB%BA%E6%A0%85%E6%A0%BC"><span class="toc-number">2.11.</span> <span class="toc-text">从数组创建栅格</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9B%BF%E6%8D%A2%E6%97%A0%E6%95%88%E5%80%BC"><span class="toc-number">2.12.</span> <span class="toc-text">替换无效值</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%8A%95%E5%BD%B1"><span class="toc-number">3.</span> <span class="toc-text">投影</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%8A%95%E5%BD%B1"><span class="toc-number">3.1.</span> <span class="toc-text">创建投影</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E6%8A%95%E5%BD%B1"><span class="toc-number">3.2.</span> <span class="toc-text">重投影</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%8A%95%E5%BD%B1"><span class="toc-number">3.3.</span> <span class="toc-text">获取投影</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E6%8A%95%E5%BD%B1%E5%9B%BE%E5%B1%82"><span class="toc-number">3.4.</span> <span class="toc-text">重投影图层</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BE%93%E5%87%BA%E6%8A%95%E5%BD%B1"><span class="toc-number">3.5.</span> <span class="toc-text">输出投影</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAESRI%E6%8A%95%E5%BD%B1%E6%96%87%E4%BB%B6"><span class="toc-number">3.6.</span> <span class="toc-text">创建ESRI投影文件</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E8%B4%A8%E5%BF%83"><span class="toc-number">4.</span> <span class="toc-text">创建质心</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82"><span class="toc-number">5.</span> <span class="toc-text">矢量图层</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6"><span class="toc-number">5.1.</span> <span class="toc-text">删除文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96OGR%E9%A9%B1%E5%8A%A8%E5%88%97%E8%A1%A8"><span class="toc-number">5.2.</span> <span class="toc-text">获取OGR驱动列表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A9%B1%E5%8A%A8%E6%98%AF%E5%90%A6%E5%8F%AF%E7%94%A8"><span class="toc-number">5.3.</span> <span class="toc-text">驱动是否可用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96shapefile%E8%A6%81%E7%B4%A0%E4%B8%AA%E6%95%B0"><span class="toc-number">5.4.</span> <span class="toc-text">获取shapefile要素个数</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96PostGIS%E5%9B%BE%E5%B1%82"><span class="toc-number">5.5.</span> <span class="toc-text">获取PostGIS图层</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96PostGIS%E5%9B%BE%E5%B1%82%E7%9A%84%E8%A6%81%E7%B4%A0"><span class="toc-number">5.6.</span> <span class="toc-text">获取PostGIS图层的要素</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96ESRI-GDB%E5%9B%BE%E5%B1%82"><span class="toc-number">5.7.</span> <span class="toc-text">获取ESRI GDB图层</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E6%95%B0%E6%8D%AE%E5%88%B0%E5%86%85%E5%AD%98"><span class="toc-number">5.8.</span> <span class="toc-text">加载数据到内存</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%81%8D%E5%8E%86%E8%A6%81%E7%B4%A0"><span class="toc-number">5.9.</span> <span class="toc-text">遍历要素</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%81%8D%E5%8E%86%E8%A6%81%E7%B4%A0%E5%87%A0%E4%BD%95"><span class="toc-number">5.10.</span> <span class="toc-text">遍历要素几何</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%B1%9E%E6%80%A7"><span class="toc-number">5.11.</span> <span class="toc-text">过滤属性</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A9%BA%E9%97%B4%E8%BF%87%E6%BB%A4"><span class="toc-number">5.12.</span> <span class="toc-text">空间过滤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E8%A6%81%E7%B4%A0%E5%AD%97%E6%AE%B5"><span class="toc-number">5.13.</span> <span class="toc-text">获取要素字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96PostGIS%E5%9B%BE%E5%B1%82%E5%AD%97%E6%AE%B5"><span class="toc-number">5.14.</span> <span class="toc-text">获取PostGIS图层字段</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%9B%BE%E5%B1%82%E8%83%BD%E5%8A%9B"><span class="toc-number">5.15.</span> <span class="toc-text">获取图层能力</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WFS%E5%9B%BE%E5%B1%82%E5%92%8C%E9%81%8D%E5%8E%86%E8%A6%81%E7%B4%A0"><span class="toc-number">5.16.</span> <span class="toc-text">WFS图层和遍历要素</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E7%BD%AEHTTP%E4%BB%A3%E7%90%86"><span class="toc-number">5.17.</span> <span class="toc-text">设置HTTP代理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96CSV%E7%BB%8F%E7%BA%AC%E5%BA%A6%E4%BD%9C%E4%B8%BAOGRVRTLayer"><span class="toc-number">5.18.</span> <span class="toc-text">读取CSV经纬度作为OGRVRTLayer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E8%8C%83%E5%9B%B4"><span class="toc-number">5.19.</span> <span class="toc-text">计算范围</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E5%87%B8%E5%8C%85"><span class="toc-number">5.20.</span> <span class="toc-text">计算凸包</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%A1%E7%AE%97%E8%B4%A8%E5%BF%83"><span class="toc-number">5.21.</span> <span class="toc-text">计算质心</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%B0%E7%9A%84shp%E6%95%B0%E6%8D%AE%E5%B9%B6%E6%B7%BB%E5%8A%A0%E6%95%B0%E6%8D%AE"><span class="toc-number">5.22.</span> <span class="toc-text">创建新的shp数据并添加数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8EWKT%E5%88%9B%E5%BB%BAPostGIS%E8%A1%A8"><span class="toc-number">5.23.</span> <span class="toc-text">从WKT创建PostGIS表</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%92%8C%E9%80%89%E6%8B%A9"><span class="toc-number">5.24.</span> <span class="toc-text">过滤和选择</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%88%E5%B9%B6%E5%9B%BE%E5%B1%82"><span class="toc-number">5.25.</span> <span class="toc-text">合并图层</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96OSM%E8%A1%97%E9%81%93%E5%90%8D%E7%A7%B0"><span class="toc-number">5.26.</span> <span class="toc-text">获取OSM街道名称</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E9%B1%BC%E7%BD%91"><span class="toc-number">5.27.</span> <span class="toc-text">创建鱼网</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E8%BD%AC%E7%BA%BF"><span class="toc-number">5.28.</span> <span class="toc-text">面转线</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%BC%93%E5%86%B2%E5%8C%BA"><span class="toc-number">5.29.</span> <span class="toc-text">创建缓冲区</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%85%E6%A0%BC%E5%8C%96%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82"><span class="toc-number">5.30.</span> <span class="toc-text">栅格化矢量图层</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%A2%E8%BD%AC%E7%82%B9"><span class="toc-number">5.31.</span> <span class="toc-text">面转点</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/07/16/xue-xi-rasterio-huan-shi-gdal/" title="学习Rasterio还是GDAL？"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/ytkz11/picture/imgs202507161641974.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="学习Rasterio还是GDAL？"/></a><div class="content"><a class="title" href="/2025/07/16/xue-xi-rasterio-huan-shi-gdal/" title="学习Rasterio还是GDAL？">学习Rasterio还是GDAL？</a><time datetime="2025-07-16T12:20:10.000Z" title="发表于 2025-07-16 20:20:10">2025-07-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/11/gao-bie-gdal-translate-ying-jie-gdal-tong-yi-ming-ling-xing-xin-shi-dai/" title="告别 gdal_translate：迎接 GDAL 统一命令行新时代"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/ytkz11/picture/imgs202507111500105.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="告别 gdal_translate：迎接 GDAL 统一命令行新时代"/></a><div class="content"><a class="title" href="/2025/07/11/gao-bie-gdal-translate-ying-jie-gdal-tong-yi-ming-ling-xing-xin-shi-dai/" title="告别 gdal_translate：迎接 GDAL 统一命令行新时代">告别 gdal_translate：迎接 GDAL 统一命令行新时代</a><time datetime="2025-07-11T12:20:10.000Z" title="发表于 2025-07-11 20:20:10">2025-07-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/11/jian-yao-jie-shao-gdal-de-jia-gou-guan-jian-zu-jian-he-gong-neng/" title="简要介绍 GDAL 的架构、关键组件和功能"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/ytkz11/picture/imgs202507111438678.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="简要介绍 GDAL 的架构、关键组件和功能"/></a><div class="content"><a class="title" href="/2025/07/11/jian-yao-jie-shao-gdal-de-jia-gou-guan-jian-zu-jian-he-gong-neng/" title="简要介绍 GDAL 的架构、关键组件和功能">简要介绍 GDAL 的架构、关键组件和功能</a><time datetime="2025-07-11T12:20:10.000Z" title="发表于 2025-07-11 20:20:10">2025-07-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/10/gdal-ogr-jian-dan-de-shi-yong-jiao-cheng/" title="GDAL_OGR简单的使用教程"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/ytkz11/picture/imgs202507161641982.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="GDAL_OGR简单的使用教程"/></a><div class="content"><a class="title" href="/2025/07/10/gdal-ogr-jian-dan-de-shi-yong-jiao-cheng/" title="GDAL_OGR简单的使用教程">GDAL_OGR简单的使用教程</a><time datetime="2025-07-10T12:20:10.000Z" title="发表于 2025-07-10 20:20:10">2025-07-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/10/yao-gan-dao-di-shi-ge-sha/" title="遥感到底是个啥"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/ytkz11/picture/imgs202507101625855.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="遥感到底是个啥"/></a><div class="content"><a class="title" href="/2025/07/10/yao-gan-dao-di-shi-ge-sha/" title="遥感到底是个啥">遥感到底是个啥</a><time datetime="2025-07-10T12:20:10.000Z" title="发表于 2025-07-10 20:20:10">2025-07-10</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2020 - 2025 By <a class="footer-bar-link" href="/" title="ytkz" target="_blank">ytkz</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">317</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">52</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">79</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/GDAL/" style="font-size: 0.88rem;">GDAL<sup>4</sup></a><a href="/tags/GEE/" style="font-size: 0.88rem;">GEE<sup>1</sup></a><a href="/tags/GIS/" style="font-size: 0.88rem;">GIS<sup>8</sup></a><a href="/tags/IDL/" style="font-size: 0.88rem;">IDL<sup>1</sup></a><a href="/tags/JavaScript/" style="font-size: 0.88rem;">JavaScript<sup>1</sup></a><a href="/tags/Python/" style="font-size: 0.88rem;">Python<sup>11</sup></a><a href="/tags/SAR/" style="font-size: 0.88rem;">SAR<sup>2</sup></a><a href="/tags/Sentinel5/" style="font-size: 0.88rem;">Sentinel5<sup>3</sup></a><a href="/tags/arcgis/" style="font-size: 0.88rem;">arcgis<sup>1</sup></a><a href="/tags/cpp/" style="font-size: 0.88rem;">cpp<sup>2</sup></a><a href="/tags/deep-learn/" style="font-size: 0.88rem;">deep_learn<sup>1</sup></a><a href="/tags/ffmpeg/" style="font-size: 0.88rem;">ffmpeg<sup>1</sup></a><a href="/tags/gdal/" style="font-size: 0.88rem;">gdal<sup>5</sup></a><a href="/tags/gis/" style="font-size: 0.88rem;">gis<sup>4</sup></a><a href="/tags/golang/" style="font-size: 0.88rem;">golang<sup>1</sup></a><a href="/tags/himawari8/" style="font-size: 0.88rem;">himawari8<sup>1</sup></a><a href="/tags/kotlin/" style="font-size: 0.88rem;">kotlin<sup>3</sup></a><a href="/tags/leetcode/" style="font-size: 0.88rem;">leetcode<sup>1</sup></a><a href="/tags/linux/" style="font-size: 0.88rem;">linux<sup>6</sup></a><a href="/tags/matlab/" style="font-size: 0.88rem;">matlab<sup>4</sup></a><a href="/tags/pyside6/" style="font-size: 0.88rem;">pyside6<sup>2</sup></a><a href="/tags/python/" style="font-size: 0.88rem;">python<sup>47</sup></a><a href="/tags/rust/" style="font-size: 0.88rem;">rust<sup>1</sup></a><a href="/tags/sar/" style="font-size: 0.88rem;">sar<sup>5</sup></a><a href="/tags/shp/" style="font-size: 0.88rem;">shp<sup>1</sup></a><a href="/tags/vs/" style="font-size: 0.88rem;">vs<sup>1</sup></a><a href="/tags/%E4%B8%8B%E8%BD%BD/" style="font-size: 0.88rem;">下载<sup>1</sup></a><a href="/tags/%E5%8C%80%E8%89%B2/" style="font-size: 0.88rem;">匀色<sup>1</sup></a><a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 0.88rem;">工具<sup>2</sup></a><a href="/tags/%E6%8A%80%E6%9C%AF/" style="font-size: 0.88rem;">技术<sup>3</sup></a><a href="/tags/%E6%A1%88%E4%BB%B6/" style="font-size: 0.88rem;">案件<sup>1</sup></a><a href="/tags/%E6%B3%A8%E5%86%8C%E6%B5%8B%E7%BB%98%E5%B8%88/" style="font-size: 0.88rem;">注册测绘师<sup>13</sup></a><a href="/tags/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" style="font-size: 0.88rem;">深度学习<sup>15</sup></a><a href="/tags/%E7%88%AC%E8%99%AB/" style="font-size: 0.88rem;">爬虫<sup>1</sup></a><a href="/tags/%E7%9F%A2%E9%87%8F/" style="font-size: 0.88rem;">矢量<sup>26</sup></a><a href="/tags/%E7%BB%98%E5%9B%BE/" style="font-size: 0.88rem;">绘图<sup>1</sup></a><a href="/tags/%E7%BC%96%E7%A8%8B/" style="font-size: 0.88rem;">编程<sup>19</sup></a><a href="/tags/%E9%81%A5%E6%84%9F/" style="font-size: 0.88rem;">遥感<sup>183</sup></a><a href="/tags/%E9%81%A5%E6%84%9F-%E7%9F%A2%E9%87%8F/" style="font-size: 0.88rem;">遥感,矢量<sup>1</sup></a><a href="/tags/%E9%97%B2%E8%81%8A/" style="font-size: 0.88rem;">闲聊<sup>2</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2020 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 ytkz 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><div class="js-pjax"><input type="hidden" name="page-type" id="page-type" value="post"></div><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"react":{"opacity":0.7}});</script></body></html>